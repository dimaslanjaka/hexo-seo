"use strict";
module.exports = List;
var Shim = require("./shim");
var GenericCollection = require("./generic-collection");
var GenericOrder = require("./generic-order");
function List(values, equals, getDefault) {
    return List._init(List, this, values, equals, getDefault);
}
List._init = function (constructor, object, values, equals, getDefault) {
    if (!(object instanceof constructor)) {
        return new constructor(values, equals, getDefault);
    }
    var head = object.head = new object.Node();
    head.next = head;
    head.prev = head;
    object.contentEquals = equals || Object.equals;
    object.getDefault = getDefault || Function.noop;
    object.length = 0;
    object.addEach(values);
};
List.List = List; // hack so require("list").List will work in MontageJS
Object.addEach(List.prototype, GenericCollection.prototype);
Object.addEach(List.prototype, GenericOrder.prototype);
List.from = GenericCollection.from;
List.prototype.constructClone = function (values) {
    return new this.constructor(values, this.contentEquals, this.getDefault);
};
List.prototype.find = function (value, equals, index) {
    equals = equals || this.contentEquals;
    var head = this.head;
    var at = this.scan(index, head.next);
    while (at !== head) {
        if (equals(at.value, value)) {
            return at;
        }
        at = at.next;
    }
};
List.prototype.findLast = function (value, equals, index) {
    equals = equals || this.contentEquals;
    var head = this.head;
    var at = this.scan(index, head.prev);
    while (at !== head) {
        if (equals(at.value, value)) {
            return at;
        }
        at = at.prev;
    }
};
List.prototype.has = function (value, equals) {
    return !!this.find(value, equals);
};
List.prototype.get = function (value, equals) {
    var found = this.find(value, equals);
    if (found) {
        return found.value;
    }
    return this.getDefault(value);
};
// LIFO (delete removes the most recently added equivalent value)
List.prototype["delete"] = function (value, equals) {
    var found = this.findLast(value, equals);
    if (found) {
        found["delete"]();
        this.length--;
        return true;
    }
    return false;
};
List.prototype.deleteAll = function (value, equals) {
    equals = equals || this.contentEquals;
    var head = this.head;
    var at = head.next;
    var count = 0;
    while (at !== head) {
        if (equals(value, at.value)) {
            at["delete"]();
            count++;
        }
        at = at.next;
    }
    this.length -= count;
    return count;
};
List.prototype.clear = function () {
    this.head.next = this.head.prev = this.head;
    this.length = 0;
};
List.prototype.add = function (value) {
    var node = new this.Node(value);
    return this._addNode(node);
};
List.prototype._addNode = function (node) {
    this.head.addBefore(node);
    this.length++;
    return true;
};
List.prototype.push = function () {
    var head = this.head;
    for (var i = 0; i < arguments.length; i++) {
        var value = arguments[i];
        var node = new this.Node(value);
        head.addBefore(node);
    }
    this.length += arguments.length;
};
List.prototype.unshift = function () {
    var at = this.head;
    for (var i = 0; i < arguments.length; i++) {
        var value = arguments[i];
        var node = new this.Node(value);
        at.addAfter(node);
        at = node;
    }
    this.length += arguments.length;
};
List.prototype._shouldPop = function () {
    var value;
    var head = this.head;
    if (head.prev !== head) {
        value = head.prev.value;
    }
    return value;
};
List.prototype.pop = function (_before, _after) {
    var value;
    var head = this.head;
    if (head.prev !== head) {
        value = head.prev.value;
        var index = this.length - 1;
        var popDispatchValueArray = _before ? _before.call(this, value, index) : void 0;
        head.prev['delete']();
        this.length--;
        _after ? _after.call(this, value, index, popDispatchValueArray) : void 0;
    }
    return value;
};
List.prototype.shift = function (_before, _after) {
    var value;
    var head = this.head;
    if (head.prev !== head) {
        value = head.next.value;
        var dispatchValueArray = _before ? _before.call(this, value, 0) : void 0;
        head.next['delete']();
        this.length--;
        _after ? _after.call(this, value, 0, dispatchValueArray) : void 0;
    }
    return value;
};
List.prototype.peek = function () {
    if (this.head !== this.head.next) {
        return this.head.next.value;
    }
};
List.prototype.poke = function (value) {
    if (this.head !== this.head.next) {
        this.head.next.value = value;
    }
    else {
        this.push(value);
    }
};
List.prototype.one = function () {
    return this.peek();
};
// TODO
// List.prototype.indexOf = function (value) {
// };
// TODO
// List.prototype.lastIndexOf = function (value) {
// };
// an internal utility for coercing index offsets to nodes
List.prototype.scan = function (at, fallback) {
    var head = this.head;
    if (typeof at === "number") {
        var count = at;
        if (count >= 0) {
            at = head.next;
            while (count) {
                count--;
                at = at.next;
                if (at == head) {
                    break;
                }
            }
        }
        else {
            at = head;
            while (count < 0) {
                count++;
                at = at.prev;
                if (at == head) {
                    break;
                }
            }
        }
        return at;
    }
    else {
        return at || fallback;
    }
};
// at and end may both be positive or negative numbers (in which cases they
// correspond to numeric indicies, or nodes)
List.prototype.slice = function (at, end) {
    var sliced = [];
    var head = this.head;
    at = this.scan(at, head.next);
    end = this.scan(end, head);
    while (at !== end && at !== head) {
        sliced.push(at.value);
        at = at.next;
    }
    return sliced;
};
List.prototype.splice = function (at, length /*...plus*/) {
    return this.swap(at, length, Array.prototype.slice.call(arguments, 2));
};
List.prototype.swap = function (start, length, plus, _before, _after) {
    var initial = start;
    // start will be head if start is null or -1 (meaning from the end), but
    // will be head.next if start is 0 (meaning from the beginning)
    start = this.scan(start, this.head);
    if (length == null) {
        length = Infinity;
    }
    plus = Array.from(plus);
    // collect the minus array
    var minus = [];
    var at = start;
    while (length-- && length >= 0 && at !== this.head) {
        minus.push(at.value);
        at = at.next;
    }
    // before range change
    var index, startNode;
    index = _before ? _before.call(this, start, plus, minus) : void 0;
    // delete minus
    var at = start;
    for (var i = 0, at = start; i < minus.length; i++, at = at.next) {
        at["delete"]();
    }
    // add plus
    if (initial == null && at === this.head) {
        at = this.head.next;
    }
    for (var i = 0; i < plus.length; i++) {
        var node = new this.Node(plus[i]);
        at.addBefore(node);
    }
    // adjust length
    this.length += plus.length - minus.length;
    _after ? _after.call(this, start, plus, minus) : void 0;
    return minus;
};
List.prototype.reverse = function () {
    var at = this.head;
    do {
        var temp = at.next;
        at.next = at.prev;
        at.prev = temp;
        at = at.next;
    } while (at !== this.head);
    return this;
};
List.prototype.sort = function () {
    this.swap(0, this.length, this.sorted.apply(this, arguments));
};
// TODO account for missing basis argument
List.prototype.reduce = function (callback, basis /*, thisp*/) {
    var thisp = arguments[2];
    var head = this.head;
    var at = head.next;
    while (at !== head) {
        basis = callback.call(thisp, basis, at.value, at, this);
        at = at.next;
    }
    return basis;
};
List.prototype.reduceRight = function (callback, basis /*, thisp*/) {
    var thisp = arguments[2];
    var head = this.head;
    var at = head.prev;
    while (at !== head) {
        basis = callback.call(thisp, basis, at.value, at, this);
        at = at.prev;
    }
    return basis;
};
List.prototype.updateIndexes = function (node, index) {
    while (node !== this.head) {
        node.index = index++;
        node = node.next;
    }
};
List.prototype.iterate = function () {
    return new ListIterator(this.head);
};
function ListIterator(head) {
    this.head = head;
    this.at = head.next;
}
;
ListIterator.prototype.__iterationObject = null;
Object.defineProperty(ListIterator.prototype, "_iterationObject", {
    get: function () {
        return this.__iterationObject || (this.__iterationObject = { done: false, value: null });
    }
});
ListIterator.prototype.next = function () {
    if (this.at === this.head) {
        this._iterationObject.done = true;
        this._iterationObject.value = void 0;
    }
    else {
        var value = this.at.value;
        this.at = this.at.next;
        this._iterationObject.value = value;
    }
    return this._iterationObject;
};
List.prototype.Node = Node;
function Node(value) {
    this.value = value;
    this.prev = null;
    this.next = null;
}
;
Node.prototype["delete"] = function () {
    this.prev.next = this.next;
    this.next.prev = this.prev;
};
Node.prototype.addBefore = function (node) {
    var prev = this.prev;
    this.prev = node;
    node.prev = prev;
    prev.next = node;
    node.next = this;
};
Node.prototype.addAfter = function (node) {
    var next = this.next;
    this.next = node;
    node.next = next;
    next.prev = node;
    node.prev = this;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiX2xpc3QuanMiLCJzb3VyY2VSb290IjoiLi8iLCJzb3VyY2VzIjpbInBhY2thZ2VzL2pzLXByb3RvdHlwZXMvcGFja2FnZXMvY29sbGVjdGlvbnMvX2xpc3QuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBRWIsTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7QUFFdEIsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzdCLElBQUksaUJBQWlCLEdBQUcsT0FBTyxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFDeEQsSUFBSSxZQUFZLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFFOUMsU0FBUyxJQUFJLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxVQUFVO0lBQ3BDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsVUFBVSxDQUFDLENBQUM7QUFDOUQsQ0FBQztBQUVELElBQUksQ0FBQyxLQUFLLEdBQUcsVUFBVSxXQUFXLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsVUFBVTtJQUNsRSxJQUFJLENBQUMsQ0FBQyxNQUFNLFlBQVksV0FBVyxDQUFDLEVBQUU7UUFDbEMsT0FBTyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0tBQ3REO0lBQ0QsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMzQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztJQUNqQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztJQUNqQixNQUFNLENBQUMsYUFBYSxHQUFHLE1BQU0sSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQy9DLE1BQU0sQ0FBQyxVQUFVLEdBQUcsVUFBVSxJQUFJLFFB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QUFJLENBQUM7QUFDckIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbm1vZHVsZS5leHBvcnRzID0gTGlzdDtcblxudmFyIFNoaW0gPSByZXF1aXJlKFwiLi9zaGltXCIpO1xudmFyIEdlbmVyaWNDb2xsZWN0aW9uID0gcmVxdWlyZShcIi4vZ2VuZXJpYy1jb2xsZWN0aW9uXCIpO1xudmFyIEdlbmVyaWNPcmRlciA9IHJlcXVpcmUoXCIuL2dlbmVyaWMtb3JkZXJcIik7XG5cbmZ1bmN0aW9uIExpc3QodmFsdWVzLCBlcXVhbHMsIGdldERlZmF1bHQpIHtcbiAgICByZXR1cm4gTGlzdC5faW5pdChMaXN0LCB0aGlzLCB2YWx1ZXMsIGVxdWFscywgZ2V0RGVmYXVsdCk7XG59XG5cbkxpc3QuX2luaXQgPSBmdW5jdGlvbiAoY29uc3RydWN0b3IsIG9iamVjdCwgdmFsdWVzLCBlcXVhbHMsIGdldERlZmF1bHQpIHtcbiAgICBpZiAoIShvYmplY3QgaW5zdGFuY2VvZiBjb25zdHJ1Y3RvcikpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBjb25zdHJ1Y3Rvcih2YWx1ZXMsIGVxdWFscywgZ2V0RGVmYXVsdCk7XG4gICAgfVxuICAgIHZhciBoZWFkID0gb2JqZWN0LmhlYWQgPSBuZXcgb2JqZWN0Lk5vZGUoKTtcbiAgICBoZWFkLm5leHQgPSBoZWFkO1xuICAgIGhlYWQucHJldiA9IGhlYWQ7XG4gICAgb2JqZWN0LmNvbnRlbnRFcXVhbHMgPSBlcXVhbHMgfHwgT2JqZWN0LmVxdWFscztcbiAgICBvYmplY3QuZ2V0RGVmYXVsdCA9IGdldERlZmF1bHQgfHwgRnVuY3Rpb24ubm9vcDtcbiAgICBvYmplY3QubGVuZ3RoID0gMDtcbiAgICBvYmplY3QuYWRkRWFjaCh2YWx1ZXMpO1xufVxuXG5MaXN0Lkxpc3QgPSBMaXN0OyAvLyBoYWNrIHNvIHJlcXVpcmUoXCJsaXN0XCIpLkxpc3Qgd2lsbCB3b3JrIGluIE1vbnRhZ2VKU1xuXG5PYmplY3QuYWRkRWFjaChMaXN0LnByb3RvdHlwZSwgR2VuZXJpY0NvbGxlY3Rpb24ucHJvdG90eXBlKTtcbk9iamVjdC5hZGRFYWNoKExpc3QucHJvdG90eXBlLCBHZW5lcmljT3JkZXIucHJvdG90eXBlKTtcblxuTGlzdC5mcm9tID0gR2VuZXJpY0NvbGxlY3Rpb24uZnJvbTtcblxuTGlzdC5wcm90b3R5cGUuY29uc3RydWN0Q2xvbmUgPSBmdW5jdGlvbiAodmFsdWVzKSB7XG4gICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHZhbHVlcywgdGhpcy5jb250ZW50RXF1YWxzLCB0aGlzLmdldERlZmF1bHQpO1xufTtcblxuTGlzdC5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uICh2YWx1ZSwgZXF1YWxzLCBpbmRleCkge1xuICAgIGVxdWFscyA9IGVxdWFscyB8fCB0aGlzLmNvbnRlbnRFcXVhbHM7XG4gICAgdmFyIGhlYWQgPSB0aGlzLmhlYWQ7XG4gICAgdmFyIGF0ID0gdGhpcy5zY2FuKGluZGV4LCBoZWFkLm5leHQpO1xuICAgIHdoaWxlIChhdCAhPT0gaGVhZCkge1xuICAgICAgICBpZiAoZXF1YWxzKGF0LnZhbHVlLCB2YWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBhdDtcbiAgICAgICAgfVxuICAgICAgICBhdCA9IGF0Lm5leHQ7XG4gICAgfVxufTtcblxuTGlzdC5wcm90b3R5cGUuZmluZExhc3QgPSBmdW5jdGlvbiAodmFsdWUsIGVxdWFscywgaW5kZXgpIHtcbiAgICBlcXVhbHMgPSBlcXVhbHMgfHwgdGhpcy5jb250ZW50RXF1YWxzO1xuICAgIHZhciBoZWFkID0gdGhpcy5oZWFkO1xuICAgIHZhciBhdCA9IHRoaXMuc2NhbihpbmRleCwgaGVhZC5wcmV2KTtcbiAgICB3aGlsZSAoYXQgIT09IGhlYWQpIHtcbiAgICAgICAgaWYgKGVxdWFscyhhdC52YWx1ZSwgdmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gYXQ7XG4gICAgICAgIH1cbiAgICAgICAgYXQgPSBhdC5wcmV2O1xuICAgIH1cbn07XG5cbkxpc3QucHJvdG90eXBlLmhhcyA9IGZ1bmN0aW9uICh2YWx1ZSwgZXF1YWxzKSB7XG4gICAgcmV0dXJuICEhdGhpcy5maW5kKHZhbHVlLCBlcXVhbHMpO1xufTtcblxuTGlzdC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHZhbHVlLCBlcXVhbHMpIHtcbiAgICB2YXIgZm91bmQgPSB0aGlzLmZpbmQodmFsdWUsIGVxdWFscyk7XG4gICAgaWYgKGZvdW5kKSB7XG4gICAgICAgIHJldHVybiBmb3VuZC52YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZ2V0RGVmYXVsdCh2YWx1ZSk7XG59O1xuXG4vLyBMSUZPIChkZWxldGUgcmVtb3ZlcyB0aGUgbW9zdCByZWNlbnRseSBhZGRlZCBlcXVpdmFsZW50IHZhbHVlKVxuTGlzdC5wcm90b3R5cGVbXCJkZWxldGVcIl0gPSBmdW5jdGlvbiAodmFsdWUsIGVxdWFscykge1xuICAgIHZhciBmb3VuZCA9IHRoaXMuZmluZExhc3QodmFsdWUsIGVxdWFscyk7XG4gICAgaWYgKGZvdW5kKSB7XG4gICAgICAgIGZvdW5kW1wiZGVsZXRlXCJdKCk7XG4gICAgICAgIHRoaXMubGVuZ3RoLS07XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5kZWxldGVBbGwgPSBmdW5jdGlvbiAodmFsdWUsIGVxdWFscykge1xuICAgIGVxdWFscyA9IGVxdWFscyB8fCB0aGlzLmNvbnRlbnRFcXVhbHM7XG4gICAgdmFyIGhlYWQgPSB0aGlzLmhlYWQ7XG4gICAgdmFyIGF0ID0gaGVhZC5uZXh0O1xuICAgIHZhciBjb3VudCA9IDA7XG4gICAgd2hpbGUgKGF0ICE9PSBoZWFkKSB7XG4gICAgICAgIGlmIChlcXVhbHModmFsdWUsIGF0LnZhbHVlKSkge1xuICAgICAgICAgICAgYXRbXCJkZWxldGVcIl0oKTtcbiAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgICAgYXQgPSBhdC5uZXh0O1xuICAgIH1cbiAgICB0aGlzLmxlbmd0aCAtPSBjb3VudDtcbiAgICByZXR1cm4gY291bnQ7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmhlYWQubmV4dCA9IHRoaXMuaGVhZC5wcmV2ID0gdGhpcy5oZWFkO1xuICAgIHRoaXMubGVuZ3RoID0gMDtcbn07XG5cbkxpc3QucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHZhciBub2RlID0gbmV3IHRoaXMuTm9kZSh2YWx1ZSlcbiAgICByZXR1cm4gdGhpcy5fYWRkTm9kZShub2RlKTtcbn07XG5cbkxpc3QucHJvdG90eXBlLl9hZGROb2RlID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICB0aGlzLmhlYWQuYWRkQmVmb3JlKG5vZGUpO1xuICAgIHRoaXMubGVuZ3RoKys7XG4gICAgcmV0dXJuIHRydWU7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBoZWFkID0gdGhpcy5oZWFkO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgdmFyIG5vZGUgPSBuZXcgdGhpcy5Ob2RlKHZhbHVlKTtcbiAgICAgICAgaGVhZC5hZGRCZWZvcmUobm9kZSk7XG4gICAgfVxuICAgIHRoaXMubGVuZ3RoICs9IGFyZ3VtZW50cy5sZW5ndGg7XG59O1xuXG5MaXN0LnByb3RvdHlwZS51bnNoaWZ0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBhdCA9IHRoaXMuaGVhZDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgdmFsdWUgPSBhcmd1bWVudHNbaV07XG4gICAgICAgIHZhciBub2RlID0gbmV3IHRoaXMuTm9kZSh2YWx1ZSk7XG4gICAgICAgIGF0LmFkZEFmdGVyKG5vZGUpO1xuICAgICAgICBhdCA9IG5vZGU7XG4gICAgfVxuICAgIHRoaXMubGVuZ3RoICs9IGFyZ3VtZW50cy5sZW5ndGg7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5fc2hvdWxkUG9wID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB2YWx1ZTtcbiAgICB2YXIgaGVhZCA9IHRoaXMuaGVhZDtcbiAgICBpZiAoaGVhZC5wcmV2ICE9PSBoZWFkKSB7XG4gICAgICAgIHZhbHVlID0gaGVhZC5wcmV2LnZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gdmFsdWU7XG59XG5cbkxpc3QucHJvdG90eXBlLnBvcCA9IGZ1bmN0aW9uIChfYmVmb3JlLCBfYWZ0ZXIpIHtcbiAgICB2YXIgdmFsdWU7XG4gICAgdmFyIGhlYWQgPSB0aGlzLmhlYWQ7XG4gICAgaWYgKGhlYWQucHJldiAhPT0gaGVhZCkge1xuICAgICAgICB2YWx1ZSA9IGhlYWQucHJldi52YWx1ZTtcbiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5sZW5ndGggLSAxO1xuICAgICAgICB2YXIgcG9wRGlzcGF0Y2hWYWx1ZUFycmF5ID0gX2JlZm9yZSA/IF9iZWZvcmUuY2FsbCh0aGlzLHZhbHVlLGluZGV4KSA6IHZvaWQgMDtcbiAgICAgICAgaGVhZC5wcmV2WydkZWxldGUnXSgpO1xuICAgICAgICB0aGlzLmxlbmd0aC0tO1xuICAgICAgICBfYWZ0ZXIgPyBfYWZ0ZXIuY2FsbCh0aGlzLHZhbHVlLGluZGV4LCBwb3BEaXNwYXRjaFZhbHVlQXJyYXkpIDogdm9pZCAwO1xuICAgIH1cbiAgICByZXR1cm4gdmFsdWU7XG59O1xuXG5MaXN0LnByb3RvdHlwZS5zaGlmdCA9IGZ1bmN0aW9uIChfYmVmb3JlLCBfYWZ0ZXIpIHtcbiAgICB2YXIgdmFsdWU7XG4gICAgdmFyIGhlYWQgPSB0aGlzLmhlYWQ7XG4gICAgaWYgKGhlYWQucHJldiAhPT0gaGVhZCkge1xuICAgICAgICB2YWx1ZSA9IGhlYWQubmV4dC52YWx1ZTtcbiAgICAgICAgdmFyIGRpc3BhdGNoVmFsdWVBcnJheSA9IF9iZWZvcmUgPyBfYmVmb3JlLmNhbGwodGhpcyx2YWx1ZSwwKSA6IHZvaWQgMDtcbiAgICAgICAgaGVhZC5uZXh0WydkZWxldGUnXSgpO1xuICAgICAgICB0aGlzLmxlbmd0aC0tO1xuICAgICAgICBfYWZ0ZXIgPyBfYWZ0ZXIuY2FsbCh0aGlzLHZhbHVlLDAsZGlzcGF0Y2hWYWx1ZUFycmF5KSA6IHZvaWQgMDtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xufTtcblxuTGlzdC5wcm90b3R5cGUucGVlayA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5oZWFkICE9PSB0aGlzLmhlYWQubmV4dCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oZWFkLm5leHQudmFsdWU7XG4gICAgfVxufTtcblxuTGlzdC5wcm90b3R5cGUucG9rZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIGlmICh0aGlzLmhlYWQgIT09IHRoaXMuaGVhZC5uZXh0KSB7XG4gICAgICAgIHRoaXMuaGVhZC5uZXh0LnZhbHVlID0gdmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wdXNoKHZhbHVlKTtcbiAgICB9XG59O1xuXG5MaXN0LnByb3RvdHlwZS5vbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMucGVlaygpO1xufTtcblxuLy8gVE9ET1xuLy8gTGlzdC5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuLy8gfTtcblxuLy8gVE9ET1xuLy8gTGlzdC5wcm90b3R5cGUubGFzdEluZGV4T2YgPSBmdW5jdGlvbiAodmFsdWUpIHtcbi8vIH07XG5cbi8vIGFuIGludGVybmFsIHV0aWxpdHkgZm9yIGNvZXJjaW5nIGluZGV4IG9mZnNldHMgdG8gbm9kZXNcbkxpc3QucHJvdG90eXBlLnNjYW4gPSBmdW5jdGlvbiAoYXQsIGZhbGxiYWNrKSB7XG4gICAgdmFyIGhlYWQgPSB0aGlzLmhlYWQ7XG4gICAgaWYgKHR5cGVvZiBhdCA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICB2YXIgY291bnQgPSBhdDtcbiAgICAgICAgaWYgKGNvdW50ID49IDApIHtcbiAgICAgICAgICAgIGF0ID0gaGVhZC5uZXh0O1xuICAgICAgICAgICAgd2hpbGUgKGNvdW50KSB7XG4gICAgICAgICAgICAgICAgY291bnQtLTtcbiAgICAgICAgICAgICAgICBhdCA9IGF0Lm5leHQ7XG4gICAgICAgICAgICAgICAgaWYgKGF0ID09IGhlYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXQgPSBoZWFkO1xuICAgICAgICAgICAgd2hpbGUgKGNvdW50IDwgMCkge1xuICAgICAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgICAgICAgYXQgPSBhdC5wcmV2O1xuICAgICAgICAgICAgICAgIGlmIChhdCA9PSBoZWFkKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXQ7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGF0IHx8IGZhbGxiYWNrO1xuICAgIH1cbn07XG5cbi8vIGF0IGFuZCBlbmQgbWF5IGJvdGggYmUgcG9zaXRpdmUgb3IgbmVnYXRpdmUgbnVtYmVycyAoaW4gd2hpY2ggY2FzZXMgdGhleVxuLy8gY29ycmVzcG9uZCB0byBudW1lcmljIGluZGljaWVzLCBvciBub2Rlcylcbkxpc3QucHJvdG90eXBlLnNsaWNlID0gZnVuY3Rpb24gKGF0LCBlbmQpIHtcbiAgICB2YXIgc2xpY2VkID0gW107XG4gICAgdmFyIGhlYWQgPSB0aGlzLmhlYWQ7XG4gICAgYXQgPSB0aGlzLnNjYW4oYXQsIGhlYWQubmV4dCk7XG4gICAgZW5kID0gdGhpcy5zY2FuKGVuZCwgaGVhZCk7XG5cbiAgICB3aGlsZSAoYXQgIT09IGVuZCAmJiBhdCAhPT0gaGVhZCkge1xuICAgICAgICBzbGljZWQucHVzaChhdC52YWx1ZSk7XG4gICAgICAgIGF0ID0gYXQubmV4dDtcbiAgICB9XG5cbiAgICByZXR1cm4gc2xpY2VkO1xufTtcblxuTGlzdC5wcm90b3R5cGUuc3BsaWNlID0gZnVuY3Rpb24gKGF0LCBsZW5ndGggLyouLi5wbHVzKi8pIHtcbiAgICByZXR1cm4gdGhpcy5zd2FwKGF0LCBsZW5ndGgsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMikpO1xufTtcblxuTGlzdC5wcm90b3R5cGUuc3dhcCA9IGZ1bmN0aW9uIChzdGFydCwgbGVuZ3RoLCBwbHVzLCBfYmVmb3JlLCBfYWZ0ZXIpIHtcbiAgICB2YXIgaW5pdGlhbCA9IHN0YXJ0O1xuICAgIC8vIHN0YXJ0IHdpbGwgYmUgaGVhZCBpZiBzdGFydCBpcyBudWxsIG9yIC0xIChtZWFuaW5nIGZyb20gdGhlIGVuZCksIGJ1dFxuICAgIC8vIHdpbGwgYmUgaGVhZC5uZXh0IGlmIHN0YXJ0IGlzIDAgKG1lYW5pbmcgZnJvbSB0aGUgYmVnaW5uaW5nKVxuICAgIHN0YXJ0ID0gdGhpcy5zY2FuKHN0YXJ0LCB0aGlzLmhlYWQpO1xuICAgIGlmIChsZW5ndGggPT0gbnVsbCkge1xuICAgICAgICBsZW5ndGggPSBJbmZpbml0eTtcbiAgICB9XG4gICAgcGx1cyA9IEFycmF5LmZyb20ocGx1cyk7XG5cbiAgICAvLyBjb2xsZWN0IHRoZSBtaW51cyBhcnJheVxuICAgIHZhciBtaW51cyA9IFtdO1xuICAgIHZhciBhdCA9IHN0YXJ0O1xuICAgIHdoaWxlIChsZW5ndGgtLSAmJiBsZW5ndGggPj0gMCAmJiBhdCAhPT0gdGhpcy5oZWFkKSB7XG4gICAgICAgIG1pbnVzLnB1c2goYXQudmFsdWUpO1xuICAgICAgICBhdCA9IGF0Lm5leHQ7XG4gICAgfVxuXG4gICAgLy8gYmVmb3JlIHJhbmdlIGNoYW5nZVxuICAgIHZhciBpbmRleCwgc3RhcnROb2RlO1xuICAgIGluZGV4ID0gX2JlZm9yZSA/IF9iZWZvcmUuY2FsbCh0aGlzLCBzdGFydCwgcGx1cywgbWludXMpIDogdm9pZCAwO1xuXG4gICAgLy8gZGVsZXRlIG1pbnVzXG4gICAgdmFyIGF0ID0gc3RhcnQ7XG4gICAgZm9yICh2YXIgaSA9IDAsIGF0ID0gc3RhcnQ7IGkgPCBtaW51cy5sZW5ndGg7IGkrKywgYXQgPSBhdC5uZXh0KSB7XG4gICAgICAgIGF0W1wiZGVsZXRlXCJdKCk7XG4gICAgfVxuICAgIC8vIGFkZCBwbHVzXG4gICAgaWYgKGluaXRpYWwgPT0gbnVsbCAmJiBhdCA9PT0gdGhpcy5oZWFkKSB7XG4gICAgICAgIGF0ID0gdGhpcy5oZWFkLm5leHQ7XG4gICAgfVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGx1cy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgbm9kZSA9IG5ldyB0aGlzLk5vZGUocGx1c1tpXSk7XG4gICAgICAgIGF0LmFkZEJlZm9yZShub2RlKTtcbiAgICB9XG4gICAgLy8gYWRqdXN0IGxlbmd0aFxuICAgIHRoaXMubGVuZ3RoICs9IHBsdXMubGVuZ3RoIC0gbWludXMubGVuZ3RoO1xuXG4gICAgX2FmdGVyID8gX2FmdGVyLmNhbGwodGhpcywgc3RhcnQsIHBsdXMsIG1pbnVzKSA6IHZvaWQgMDtcblxuICAgIHJldHVybiBtaW51cztcbn07XG5cbkxpc3QucHJvdG90eXBlLnJldmVyc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGF0ID0gdGhpcy5oZWFkO1xuICAgIGRvIHtcbiAgICAgICAgdmFyIHRlbXAgPSBhdC5uZXh0O1xuICAgICAgICBhdC5uZXh0ID0gYXQucHJldjtcbiAgICAgICAgYXQucHJldiA9IHRlbXA7XG4gICAgICAgIGF0ID0gYXQubmV4dDtcbiAgICB9IHdoaWxlIChhdCAhPT0gdGhpcy5oZWFkKTtcbiAgICByZXR1cm4gdGhpcztcbn07XG5cbkxpc3QucHJvdG90eXBlLnNvcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zd2FwKDAsIHRoaXMubGVuZ3RoLCB0aGlzLnNvcnRlZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTtcbn07XG5cbi8vIFRPRE8gYWNjb3VudCBmb3IgbWlzc2luZyBiYXNpcyBhcmd1bWVudFxuTGlzdC5wcm90b3R5cGUucmVkdWNlID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBiYXNpcyAvKiwgdGhpc3AqLykge1xuICAgIHZhciB0aGlzcCA9IGFyZ3VtZW50c1syXTtcbiAgICB2YXIgaGVhZCA9IHRoaXMuaGVhZDtcbiAgICB2YXIgYXQgPSBoZWFkLm5leHQ7XG4gICAgd2hpbGUgKGF0ICE9PSBoZWFkKSB7XG4gICAgICAgIGJhc2lzID0gY2FsbGJhY2suY2FsbCh0aGlzcCwgYmFzaXMsIGF0LnZhbHVlLCBhdCwgdGhpcyk7XG4gICAgICAgIGF0ID0gYXQubmV4dDtcbiAgICB9XG4gICAgcmV0dXJuIGJhc2lzO1xufTtcblxuTGlzdC5wcm90b3R5cGUucmVkdWNlUmlnaHQgPSBmdW5jdGlvbiAoY2FsbGJhY2ssIGJhc2lzIC8qLCB0aGlzcCovKSB7XG4gICAgdmFyIHRoaXNwID0gYXJndW1lbnRzWzJdO1xuICAgIHZhciBoZWFkID0gdGhpcy5oZWFkO1xuICAgIHZhciBhdCA9IGhlYWQucHJldjtcbiAgICB3aGlsZSAoYXQgIT09IGhlYWQpIHtcbiAgICAgICAgYmFzaXMgPSBjYWxsYmFjay5jYWxsKHRoaXNwLCBiYXNpcywgYXQudmFsdWUsIGF0LCB0aGlzKTtcbiAgICAgICAgYXQgPSBhdC5wcmV2O1xuICAgIH1cbiAgICByZXR1cm4gYmFzaXM7XG59O1xuXG5MaXN0LnByb3RvdHlwZS51cGRhdGVJbmRleGVzID0gZnVuY3Rpb24gKG5vZGUsIGluZGV4KSB7XG4gICAgd2hpbGUgKG5vZGUgIT09IHRoaXMuaGVhZCkge1xuICAgICAgICBub2RlLmluZGV4ID0gaW5kZXgrKztcbiAgICAgICAgbm9kZSA9IG5vZGUubmV4dDtcbiAgICB9XG59O1xuXG5cbkxpc3QucHJvdG90eXBlLml0ZXJhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBMaXN0SXRlcmF0b3IodGhpcy5oZWFkKTtcbn07XG5cbmZ1bmN0aW9uIExpc3RJdGVyYXRvcihoZWFkKSB7XG4gICAgdGhpcy5oZWFkID0gaGVhZDtcbiAgICB0aGlzLmF0ID0gaGVhZC5uZXh0O1xufTtcblxuTGlzdEl0ZXJhdG9yLnByb3RvdHlwZS5fX2l0ZXJhdGlvbk9iamVjdCA9IG51bGw7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoTGlzdEl0ZXJhdG9yLnByb3RvdHlwZSxcIl9pdGVyYXRpb25PYmplY3RcIiwge1xuICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9faXRlcmF0aW9uT2JqZWN0IHx8ICh0aGlzLl9faXRlcmF0aW9uT2JqZWN0ID0geyBkb25lOiBmYWxzZSwgdmFsdWU6bnVsbH0pO1xuICAgIH1cbn0pO1xuXG5cbkxpc3RJdGVyYXRvci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5hdCA9PT0gdGhpcy5oZWFkKSB7XG4gICAgICAgIHRoaXMuX2l0ZXJhdGlvbk9iamVjdC5kb25lID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5faXRlcmF0aW9uT2JqZWN0LnZhbHVlID0gdm9pZCAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuYXQudmFsdWU7XG4gICAgICAgIHRoaXMuYXQgPSB0aGlzLmF0Lm5leHQ7XG4gICAgICAgIHRoaXMuX2l0ZXJhdGlvbk9iamVjdC52YWx1ZSA9IHZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5faXRlcmF0aW9uT2JqZWN0O1xufTtcblxuTGlzdC5wcm90b3R5cGUuTm9kZSA9IE5vZGU7XG5cbmZ1bmN0aW9uIE5vZGUodmFsdWUpIHtcbiAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgdGhpcy5wcmV2ID0gbnVsbDtcbiAgICB0aGlzLm5leHQgPSBudWxsO1xufTtcblxuTm9kZS5wcm90b3R5cGVbXCJkZWxldGVcIl0gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5wcmV2Lm5leHQgPSB0aGlzLm5leHQ7XG4gICAgdGhpcy5uZXh0LnByZXYgPSB0aGlzLnByZXY7XG59O1xuXG5Ob2RlLnByb3RvdHlwZS5hZGRCZWZvcmUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIHZhciBwcmV2ID0gdGhpcy5wcmV2O1xuICAgIHRoaXMucHJldiA9IG5vZGU7XG4gICAgbm9kZS5wcmV2ID0gcHJldjtcbiAgICBwcmV2Lm5leHQgPSBub2RlO1xuICAgIG5vZGUubmV4dCA9IHRoaXM7XG59O1xuXG5Ob2RlLnByb3RvdHlwZS5hZGRBZnRlciA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgdmFyIG5leHQgPSB0aGlzLm5leHQ7XG4gICAgdGhpcy5uZXh0ID0gbm9kZTtcbiAgICBub2RlLm5leHQgPSBuZXh0O1xuICAgIG5leHQucHJldiA9IG5vZGU7XG4gICAgbm9kZS5wcmV2ID0gdGhpcztcbn07XG4iXX0=