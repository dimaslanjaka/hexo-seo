"use strict";
var LfuMap = require("collections/lfu-map");
var describeDict = require("./dict");
var describeMap = require("./map");
var describeToJson = require("./to-json");
describe("LfuMap-spec", function () {
    describeDict(LfuMap);
    describeMap(LfuMap);
    describeToJson(LfuMap, [[{ a: 1 }, 10], [{ b: 2 }, 20], [{ c: 3 }, 30]]);
    it("should remove stale entries", function () {
        var map = LfuMap({ a: 10, b: 20, c: 30 }, 3);
        map.get("a");
        map.get("b");
        map.set("d", 40);
        expect(map.keysArray()).toEqual(['d', 'a', 'b']);
        expect(map.length).toBe(3);
    });
    it("should not grow when re-adding", function () {
        var map = LfuMap({ a: 10, b: 20, c: 30 }, 3);
        expect(map.keysArray()).toEqual(['a', 'b', 'c']);
        expect(map.length).toBe(3);
        map.get("b");
        expect(map.keysArray()).toEqual(['a', 'c', 'b']);
        expect(map.length).toBe(3);
        map.set("c", 40);
        expect(map.keysArray()).toEqual(['a', 'b', 'c']);
        expect(map.length).toBe(3);
    });
    it("should grow when adding new values", function () {
        var map = LfuMap({}, 3);
        expect(map.length).toBe(0);
        map.set("a", 10);
        expect(map.length).toBe(1);
        map.set("a", 10);
        expect(map.length).toBe(1);
        map.set("b", 20);
        expect(map.length).toBe(2);
        map.set("b", 20);
        expect(map.length).toBe(2);
        map.set("c", 30);
        expect(map.length).toBe(3);
        map.set("c", 30);
        expect(map.length).toBe(3);
        // stops growing
        map.set("d", 40);
        expect(map.length).toBe(3);
        map.set("d", 40);
        expect(map.length).toBe(3);
        map.set("e", 50);
        expect(map.length).toBe(3);
    });
    it("should dispatch deletion for stale entries", function () {
        var map = LfuMap({ a: 10, b: 20, c: 30 }, 3);
        var spy = jasmine.createSpy();
        map.addBeforeMapChangeListener(function (value, key) {
            spy('before', key, value);
        });
        map.addMapChangeListener(function (value, key) {
            spy('after', key, value);
        });
        map.set('d', 40);
        var argsForCall = spy.calls.all().map(function (call) { return call.args; });
        expect(argsForCall).toEqual([
            ['before', 'd', undefined],
            ['before', 'a', undefined],
            ['after', 'a', undefined],
            ['after', 'd', 40] // and now d has a value
        ]);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGZ1LW1hcC1zcGVjLmpzIiwic291cmNlUm9vdCI6Ii4vIiwic291cmNlcyI6WyJwYWNrYWdlcy9qcy1wcm90b3R5cGVzL3BhY2thZ2VzL2NvbGxlY3Rpb25zL3Rlc3Qvc3BlYy9sZnUtbWFwLXNwZWMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQzVDLElBQUksWUFBWSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNyQyxJQUFJLFdBQVcsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDbkMsSUFBSSxjQUFjLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBRTFDLFFBQVEsQ0FBQyxhQUFhLEVBQUU7SUFFcEIsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3JCLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNwQixjQUFjLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRW5FLEVBQUUsQ0FBQyw2QkFBNkIsRUFBRTtRQUM5QixJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsRUFBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzNDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDYixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNqRCxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMvQixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRTtRQUNqQyxJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsRUFBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRTNDLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDakQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFM0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNiLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDakQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFM0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNqRCxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMvQixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRTtRQUNyQyxJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTNCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTNCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTNCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTNCLGdCQUFnQjtRQUNoQixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzQixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUUzQixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMvQixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRTtRQUM3QyxJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsRUFBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzNDLElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUM5QixHQUFHLENBQUMsMEJBQTBCLENBQUMsVUFBVSxLQUFLLEVBQUUsR0FBRztZQUMvQyxHQUFHLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FBQztRQUNILEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxVQUFVLEtBQUssRUFBRSxHQUFHO1lBQ3pDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzdCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFakIsSUFBSSxXQUFXLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsVUFBVSxJQUFJLElBQUksT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDNUUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUN4QixDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsU0FBUyxDQUFDO1lBQzFCLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxTQUFTLENBQUM7WUFDMUIsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsQ0FBQztZQUN6QixDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQVUsd0JBQXdCO1NBQ3ZELENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcbnZhciBMZnVNYXAgPSByZXF1aXJlKFwiY29sbGVjdGlvbnMvbGZ1LW1hcFwiKTtcbnZhciBkZXNjcmliZURpY3QgPSByZXF1aXJlKFwiLi9kaWN0XCIpO1xudmFyIGRlc2NyaWJlTWFwID0gcmVxdWlyZShcIi4vbWFwXCIpO1xudmFyIGRlc2NyaWJlVG9Kc29uID0gcmVxdWlyZShcIi4vdG8tanNvblwiKTtcblxuZGVzY3JpYmUoXCJMZnVNYXAtc3BlY1wiLCBmdW5jdGlvbiAoKSB7XG5cbiAgICBkZXNjcmliZURpY3QoTGZ1TWFwKTtcbiAgICBkZXNjcmliZU1hcChMZnVNYXApO1xuICAgIGRlc2NyaWJlVG9Kc29uKExmdU1hcCwgW1t7YTogMX0sIDEwXSwgW3tiOiAyfSwgMjBdLCBbe2M6IDN9LCAzMF1dKTtcblxuICAgIGl0KFwic2hvdWxkIHJlbW92ZSBzdGFsZSBlbnRyaWVzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1hcCA9IExmdU1hcCh7YTogMTAsIGI6IDIwLCBjOiAzMH0sIDMpO1xuICAgICAgICBtYXAuZ2V0KFwiYVwiKTtcbiAgICAgICAgbWFwLmdldChcImJcIik7XG4gICAgICAgIG1hcC5zZXQoXCJkXCIsIDQwKTtcbiAgICAgICAgZXhwZWN0KG1hcC5rZXlzQXJyYXkoKSkudG9FcXVhbChbJ2QnLCAnYScsICdiJ10pO1xuICAgICAgICBleHBlY3QobWFwLmxlbmd0aCkudG9CZSgzKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIG5vdCBncm93IHdoZW4gcmUtYWRkaW5nXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1hcCA9IExmdU1hcCh7YTogMTAsIGI6IDIwLCBjOiAzMH0sIDMpO1xuXG4gICAgICAgIGV4cGVjdChtYXAua2V5c0FycmF5KCkpLnRvRXF1YWwoWydhJywgJ2InLCAnYyddKTtcbiAgICAgICAgZXhwZWN0KG1hcC5sZW5ndGgpLnRvQmUoMyk7XG5cbiAgICAgICAgbWFwLmdldChcImJcIik7XG4gICAgICAgIGV4cGVjdChtYXAua2V5c0FycmF5KCkpLnRvRXF1YWwoWydhJywgJ2MnLCAnYiddKTtcbiAgICAgICAgZXhwZWN0KG1hcC5sZW5ndGgpLnRvQmUoMyk7XG5cbiAgICAgICAgbWFwLnNldChcImNcIiwgNDApO1xuICAgICAgICBleHBlY3QobWFwLmtleXNBcnJheSgpKS50b0VxdWFsKFsnYScsICdiJywgJ2MnXSk7XG4gICAgICAgIGV4cGVjdChtYXAubGVuZ3RoKS50b0JlKDMpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgZ3JvdyB3aGVuIGFkZGluZyBuZXcgdmFsdWVzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1hcCA9IExmdU1hcCh7fSwgMyk7XG4gICAgICAgIGV4cGVjdChtYXAubGVuZ3RoKS50b0JlKDApO1xuXG4gICAgICAgIG1hcC5zZXQoXCJhXCIsIDEwKTtcbiAgICAgICAgZXhwZWN0KG1hcC5sZW5ndGgpLnRvQmUoMSk7XG4gICAgICAgIG1hcC5zZXQoXCJhXCIsIDEwKTtcbiAgICAgICAgZXhwZWN0KG1hcC5sZW5ndGgpLnRvQmUoMSk7XG5cbiAgICAgICAgbWFwLnNldChcImJcIiwgMjApO1xuICAgICAgICBleHBlY3QobWFwLmxlbmd0aCkudG9CZSgyKTtcbiAgICAgICAgbWFwLnNldChcImJcIiwgMjApO1xuICAgICAgICBleHBlY3QobWFwLmxlbmd0aCkudG9CZSgyKTtcblxuICAgICAgICBtYXAuc2V0KFwiY1wiLCAzMCk7XG4gICAgICAgIGV4cGVjdChtYXAubGVuZ3RoKS50b0JlKDMpO1xuICAgICAgICBtYXAuc2V0KFwiY1wiLCAzMCk7XG4gICAgICAgIGV4cGVjdChtYXAubGVuZ3RoKS50b0JlKDMpO1xuXG4gICAgICAgIC8vIHN0b3BzIGdyb3dpbmdcbiAgICAgICAgbWFwLnNldChcImRcIiwgNDApO1xuICAgICAgICBleHBlY3QobWFwLmxlbmd0aCkudG9CZSgzKTtcbiAgICAgICAgbWFwLnNldChcImRcIiwgNDApO1xuICAgICAgICBleHBlY3QobWFwLmxlbmd0aCkudG9CZSgzKTtcblxuICAgICAgICBtYXAuc2V0KFwiZVwiLCA1MCk7XG4gICAgICAgIGV4cGVjdChtYXAubGVuZ3RoKS50b0JlKDMpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgZGlzcGF0Y2ggZGVsZXRpb24gZm9yIHN0YWxlIGVudHJpZXNcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbWFwID0gTGZ1TWFwKHthOiAxMCwgYjogMjAsIGM6IDMwfSwgMyk7XG4gICAgICAgIHZhciBzcHkgPSBqYXNtaW5lLmNyZWF0ZVNweSgpO1xuICAgICAgICBtYXAuYWRkQmVmb3JlTWFwQ2hhbmdlTGlzdGVuZXIoZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgIHNweSgnYmVmb3JlJywga2V5LCB2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBtYXAuYWRkTWFwQ2hhbmdlTGlzdGVuZXIoZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgIHNweSgnYWZ0ZXInLCBrZXksIHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIG1hcC5zZXQoJ2QnLCA0MCk7XG4gICAgICAgIFxuICAgICAgICB2YXIgYXJnc0ZvckNhbGwgPSBzcHkuY2FsbHMuYWxsKCkubWFwKGZ1bmN0aW9uIChjYWxsKSB7IHJldHVybiBjYWxsLmFyZ3MgfSk7XG4gICAgICAgIGV4cGVjdChhcmdzRm9yQ2FsbCkudG9FcXVhbChbXG4gICAgICAgICAgICBbJ2JlZm9yZScsICdkJywgdW5kZWZpbmVkXSwgLy8gZCB3aWxsIGJlIGFkZGVkXG4gICAgICAgICAgICBbJ2JlZm9yZScsICdhJywgdW5kZWZpbmVkXSwgLy8gdGhlbiBhIGlzIHBydW5lZCAoc3RhbGUpXG4gICAgICAgICAgICBbJ2FmdGVyJywgJ2EnLCB1bmRlZmluZWRdLCAgLy8gYWZ0ZXJ3YXJkcyBhIGlzIHN0aWxsIHBydW5lZFxuICAgICAgICAgICAgWydhZnRlcicsICdkJywgNDBdICAgICAgICAgIC8vIGFuZCBub3cgZCBoYXMgYSB2YWx1ZVxuICAgICAgICBdKTtcbiAgICB9KTtcbn0pO1xuIl19