"use strict";
var LruMap = require("collections/lru-map");
var describeDict = require("./dict");
var describeMap = require("./map");
var describeToJson = require("./to-json");
describe("LruMap-spec", function () {
    describeDict(LruMap);
    describeMap(LruMap);
    describeToJson(LruMap, [[{ a: 1 }, 10], [{ b: 2 }, 20], [{ c: 3 }, 30]]);
    it("should remove stale entries", function () {
        var map = LruMap({ a: 10, b: 20, c: 30 }, 3);
        map.get("b");
        map.set("d", 40);
        expect(map.keysArray()).toEqual(['c', 'b', 'd']);
        expect(map.length).toBe(3);
    });
    it("should not grow when re-adding", function () {
        var map = LruMap({ a: 10, b: 20, c: 30 }, 3);
        expect(map.keysArray()).toEqual(['a', 'b', 'c']);
        expect(map.length).toBe(3);
        map.get("b");
        expect(map.keysArray()).toEqual(['a', 'c', 'b']);
        expect(map.length).toBe(3);
        map.set("c", 40);
        expect(map.keysArray()).toEqual(['a', 'b', 'c']);
        expect(map.length).toBe(3);
    });
    it("should grow when adding new values", function () {
        var map = LruMap({}, 3);
        expect(map.length).toBe(0);
        map.set("a", 10);
        expect(map.length).toBe(1);
        map.set("a", 10);
        expect(map.length).toBe(1);
        map.set("b", 20);
        expect(map.length).toBe(2);
        map.set("b", 20);
        expect(map.length).toBe(2);
        map.set("c", 30);
        expect(map.length).toBe(3);
        map.set("c", 30);
        expect(map.length).toBe(3);
        // stops growing
        map.set("d", 40);
        expect(map.length).toBe(3);
        map.set("d", 40);
        expect(map.length).toBe(3);
        map.set("e", 50);
        expect(map.length).toBe(3);
    });
    it("should dispatch deletion for stale entries", function () {
        var map = LruMap({ a: 10, b: 20, c: 30 }, 3);
        var spy = jasmine.createSpy();
        map.addBeforeMapChangeListener(function (value, key) {
            spy('before', key, value);
        });
        map.addMapChangeListener(function (value, key) {
            spy('after', key, value);
        });
        map.set('d', 40);
        var argsForCall = spy.calls.all().map(function (call) { return call.args; });
        expect(argsForCall).toEqual([
            ['before', 'd', undefined],
            ['before', 'a', undefined],
            ['after', 'a', undefined],
            ['after', 'd', 40] // and now d has a value
        ]);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibHJ1LW1hcC1zcGVjLmpzIiwic291cmNlUm9vdCI6Ii4vIiwic291cmNlcyI6WyJwYWNrYWdlcy9qcy1wcm90b3R5cGVzL3BhY2thZ2VzL2NvbGxlY3Rpb25zL3Rlc3Qvc3BlYy9scnUtbWFwLXNwZWMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQzVDLElBQUksWUFBWSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNyQyxJQUFJLFdBQVcsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDbkMsSUFBSSxjQUFjLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBRTFDLFFBQVEsQ0FBQyxhQUFhLEVBQUU7SUFFcEIsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3JCLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNwQixjQUFjLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRW5FLEVBQUUsQ0FBQyw2QkFBNkIsRUFBRTtRQUM5QixJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsRUFBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzNDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDYixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2pELE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQy9CLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLGdDQUFnQyxFQUFFO1FBQ2pDLElBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxFQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFM0MsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNqRCxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUUzQixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNqRCxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUUzQixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNqQixNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2pELE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQy9CLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLG9DQUFvQyxFQUFFO1FBQ3JDLElBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDeEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFM0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFM0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFM0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFM0IsZ0JBQWdCO1FBQ2hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTNCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQy9CLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDRDQUE0QyxFQUFFO1FBQzdDLElBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxFQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDM0MsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzlCLEdBQUcsQ0FBQywwQkFBMEIsQ0FBQyxVQUFVLEtBQUssRUFBRSxHQUFHO1lBQy9DLEdBQUcsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzlCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsR0FBRyxDQUFDLG9CQUFvQixDQUFDLFVBQVUsS0FBSyxFQUFFLEdBQUc7WUFDekMsR0FBRyxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7UUFDSCxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQixJQUFJLFdBQVcsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksSUFBSSxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM1RSxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ3hCLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxTQUFTLENBQUM7WUFDMUIsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLFNBQVMsQ0FBQztZQUMxQixDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxDQUFDO1lBQ3pCLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBVSx3QkFBd0I7U0FDdkQsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlxudmFyIExydU1hcCA9IHJlcXVpcmUoXCJjb2xsZWN0aW9ucy9scnUtbWFwXCIpO1xudmFyIGRlc2NyaWJlRGljdCA9IHJlcXVpcmUoXCIuL2RpY3RcIik7XG52YXIgZGVzY3JpYmVNYXAgPSByZXF1aXJlKFwiLi9tYXBcIik7XG52YXIgZGVzY3JpYmVUb0pzb24gPSByZXF1aXJlKFwiLi90by1qc29uXCIpO1xuXG5kZXNjcmliZShcIkxydU1hcC1zcGVjXCIsIGZ1bmN0aW9uICgpIHtcblxuICAgIGRlc2NyaWJlRGljdChMcnVNYXApO1xuICAgIGRlc2NyaWJlTWFwKExydU1hcCk7XG4gICAgZGVzY3JpYmVUb0pzb24oTHJ1TWFwLCBbW3thOiAxfSwgMTBdLCBbe2I6IDJ9LCAyMF0sIFt7YzogM30sIDMwXV0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmVtb3ZlIHN0YWxlIGVudHJpZXNcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbWFwID0gTHJ1TWFwKHthOiAxMCwgYjogMjAsIGM6IDMwfSwgMyk7XG4gICAgICAgIG1hcC5nZXQoXCJiXCIpO1xuICAgICAgICBtYXAuc2V0KFwiZFwiLCA0MCk7XG4gICAgICAgIGV4cGVjdChtYXAua2V5c0FycmF5KCkpLnRvRXF1YWwoWydjJywgJ2InLCAnZCddKTtcbiAgICAgICAgZXhwZWN0KG1hcC5sZW5ndGgpLnRvQmUoMyk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBub3QgZ3JvdyB3aGVuIHJlLWFkZGluZ1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBtYXAgPSBMcnVNYXAoe2E6IDEwLCBiOiAyMCwgYzogMzB9LCAzKTtcblxuICAgICAgICBleHBlY3QobWFwLmtleXNBcnJheSgpKS50b0VxdWFsKFsnYScsICdiJywgJ2MnXSk7XG4gICAgICAgIGV4cGVjdChtYXAubGVuZ3RoKS50b0JlKDMpO1xuXG4gICAgICAgIG1hcC5nZXQoXCJiXCIpO1xuICAgICAgICBleHBlY3QobWFwLmtleXNBcnJheSgpKS50b0VxdWFsKFsnYScsICdjJywgJ2InXSk7XG4gICAgICAgIGV4cGVjdChtYXAubGVuZ3RoKS50b0JlKDMpO1xuXG4gICAgICAgIG1hcC5zZXQoXCJjXCIsIDQwKTtcbiAgICAgICAgZXhwZWN0KG1hcC5rZXlzQXJyYXkoKSkudG9FcXVhbChbJ2EnLCAnYicsICdjJ10pO1xuICAgICAgICBleHBlY3QobWFwLmxlbmd0aCkudG9CZSgzKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGdyb3cgd2hlbiBhZGRpbmcgbmV3IHZhbHVlc1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBtYXAgPSBMcnVNYXAoe30sIDMpO1xuICAgICAgICBleHBlY3QobWFwLmxlbmd0aCkudG9CZSgwKTtcblxuICAgICAgICBtYXAuc2V0KFwiYVwiLCAxMCk7XG4gICAgICAgIGV4cGVjdChtYXAubGVuZ3RoKS50b0JlKDEpO1xuICAgICAgICBtYXAuc2V0KFwiYVwiLCAxMCk7XG4gICAgICAgIGV4cGVjdChtYXAubGVuZ3RoKS50b0JlKDEpO1xuXG4gICAgICAgIG1hcC5zZXQoXCJiXCIsIDIwKTtcbiAgICAgICAgZXhwZWN0KG1hcC5sZW5ndGgpLnRvQmUoMik7XG4gICAgICAgIG1hcC5zZXQoXCJiXCIsIDIwKTtcbiAgICAgICAgZXhwZWN0KG1hcC5sZW5ndGgpLnRvQmUoMik7XG5cbiAgICAgICAgbWFwLnNldChcImNcIiwgMzApO1xuICAgICAgICBleHBlY3QobWFwLmxlbmd0aCkudG9CZSgzKTtcbiAgICAgICAgbWFwLnNldChcImNcIiwgMzApO1xuICAgICAgICBleHBlY3QobWFwLmxlbmd0aCkudG9CZSgzKTtcblxuICAgICAgICAvLyBzdG9wcyBncm93aW5nXG4gICAgICAgIG1hcC5zZXQoXCJkXCIsIDQwKTtcbiAgICAgICAgZXhwZWN0KG1hcC5sZW5ndGgpLnRvQmUoMyk7XG4gICAgICAgIG1hcC5zZXQoXCJkXCIsIDQwKTtcbiAgICAgICAgZXhwZWN0KG1hcC5sZW5ndGgpLnRvQmUoMyk7XG5cbiAgICAgICAgbWFwLnNldChcImVcIiwgNTApO1xuICAgICAgICBleHBlY3QobWFwLmxlbmd0aCkudG9CZSgzKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGRpc3BhdGNoIGRlbGV0aW9uIGZvciBzdGFsZSBlbnRyaWVzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1hcCA9IExydU1hcCh7YTogMTAsIGI6IDIwLCBjOiAzMH0sIDMpO1xuICAgICAgICB2YXIgc3B5ID0gamFzbWluZS5jcmVhdGVTcHkoKTtcbiAgICAgICAgbWFwLmFkZEJlZm9yZU1hcENoYW5nZUxpc3RlbmVyKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICBzcHkoJ2JlZm9yZScsIGtleSwgdmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgbWFwLmFkZE1hcENoYW5nZUxpc3RlbmVyKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICBzcHkoJ2FmdGVyJywga2V5LCB2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBtYXAuc2V0KCdkJywgNDApO1xuICAgICAgICBcbiAgICAgICAgdmFyIGFyZ3NGb3JDYWxsID0gc3B5LmNhbGxzLmFsbCgpLm1hcChmdW5jdGlvbiAoY2FsbCkgeyByZXR1cm4gY2FsbC5hcmdzIH0pO1xuICAgICAgICBleHBlY3QoYXJnc0ZvckNhbGwpLnRvRXF1YWwoW1xuICAgICAgICAgICAgWydiZWZvcmUnLCAnZCcsIHVuZGVmaW5lZF0sIC8vIGQgd2lsbCBiZSBhZGRlZFxuICAgICAgICAgICAgWydiZWZvcmUnLCAnYScsIHVuZGVmaW5lZF0sIC8vIHRoZW4gYSBpcyBwcnVuZWQgKHN0YWxlKVxuICAgICAgICAgICAgWydhZnRlcicsICdhJywgdW5kZWZpbmVkXSwgIC8vIGFmdGVyd2FyZHMgYSBpcyBzdGlsbCBwcnVuZWRcbiAgICAgICAgICAgIFsnYWZ0ZXInLCAnZCcsIDQwXSAgICAgICAgICAvLyBhbmQgbm93IGQgaGFzIGEgdmFsdWVcbiAgICAgICAgXSk7XG4gICAgfSk7XG59KTtcbiJdfQ==