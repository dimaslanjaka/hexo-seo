"use strict";
/*
    Based in part on observable arrays from Motorola Mobilityâ€™s Montage
    Copyright (c) 2012, Motorola Mobility LLC. All Rights Reserved.
    3-Clause BSD License
    https://github.com/motorola-mobility/montage/blob/master/LICENSE.md
*/
require("collections/shim");
var PropertyChanges = require("collections/listen/property-changes");
describe("PropertyChanges", function () {
    it("observes setter on object", function () {
        spy = jasmine.createSpy();
        var object = {};
        PropertyChanges.addBeforeOwnPropertyChangeListener(object, 'x', function (value, key) {
            spy('from', value, key);
        });
        PropertyChanges.addOwnPropertyChangeListener(object, 'x', function (value, key) {
            spy('to', value, key);
        });
        object.x = 10;
        expect(object.x).toEqual(10);
        var argsForCall = spy.calls.all().map(function (call) { return call.args; });
        expect(argsForCall).toEqual([
            ['from', undefined, 'x'],
            ['to', 10, 'x'],
        ]);
    });
    it("observes setter on object with getter/setter", function () {
        spy = jasmine.createSpy();
        var value;
        var object = Object.create(Object.prototype, {
            _x: {
                value: 10,
                writable: true
            },
            x: {
                get: function () {
                    return this._x;
                },
                set: function (_value) {
                    this._x = _value;
                },
                enumerable: false,
                configurable: true
            }
        });
        PropertyChanges.addBeforeOwnPropertyChangeListener(object, 'x', function (value, key) {
            spy('from', value, key);
        });
        PropertyChanges.addOwnPropertyChangeListener(object, 'x', function (value, key) {
            spy('to', value, key);
        });
        object.x = 20;
        expect(object.x).toEqual(20);
        var argsForCall = spy.calls.all().map(function (call) { return call.args; });
        expect(argsForCall).toEqual([
            ['from', 10, 'x'],
            ['to', 20, 'x'], // reports no change
        ]);
    });
    it("shouldn't call the listener if the new value is the same after calling the object setter", function () {
        spy = jasmine.createSpy();
        var value;
        var object = Object.create(Object.prototype, {
            x: {
                get: function () {
                    return 20;
                },
                set: function (_value) {
                    // refuse to change internal state
                },
                enumerable: false,
                configurable: true
            }
        });
        PropertyChanges.addBeforeOwnPropertyChangeListener(object, 'x', function (value, key) {
            spy('from', value, key);
        });
        PropertyChanges.addOwnPropertyChangeListener(object, 'x', function (value, key) {
            spy('to', value, key);
        });
        object.x = 10;
        expect(object.x).toEqual(20);
        expect(spy).not.toHaveBeenCalled();
    });
    it("calls setter on object when the new value is the current value", function () {
        var object = Object.create(Object.prototype, {
            _x: { value: 0, writable: true },
            x: {
                get: function () {
                    return this._x;
                },
                set: function (value) {
                    this._x = value * 2;
                },
                configurable: true,
                enumerable: true
            }
        });
        PropertyChanges.addOwnPropertyChangeListener(object, "x", function () { });
        object.x = 1;
        object.x = 2;
        expect(object.x).toBe(4);
    });
    it("handles cyclic own property change listeners", function () {
        var a = {};
        var b = {};
        PropertyChanges.addOwnPropertyChangeListener(a, 'foo', function (value) {
            b.bar = value;
        });
        PropertyChanges.addOwnPropertyChangeListener(b, 'bar', function (value) {
            a.foo = value;
        });
        a.foo = 10;
        expect(b.bar).toEqual(10);
    });
    it("handles generic own property change listeners", function () {
        var object = {
            handlePropertyChange: function (value, key) {
                expect(value).toBe(10);
                expect(key).toBe("foo");
            }
        };
        spyOn(object, "handlePropertyChange").and.callThrough();
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", object);
        object.foo = 10;
        expect(object.handlePropertyChange).toHaveBeenCalled();
    });
    it("handles generic before own property change listeners", function () {
        var object = {
            foo: 12,
            handlePropertyWillChange: function (value, key) {
                expect(value).toBe(12);
                expect(key).toBe("foo");
            }
        };
        spyOn(object, "handlePropertyWillChange").and.callThrough();
        PropertyChanges.addBeforeOwnPropertyChangeListener(object, "foo", object);
        object.foo = 10;
        expect(object.handlePropertyWillChange).toHaveBeenCalled();
    });
    it("handles specific own property change listeners", function () {
        var object = {
            handleFooChange: function (value) {
                expect(value).toBe(10);
            }
        };
        spyOn(object, "handleFooChange").and.callThrough();
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", object);
        object.foo = 10;
        expect(object.handleFooChange).toHaveBeenCalled();
    });
    it("handles specific before own property change listeners", function () {
        var object = {
            foo: 12,
            handleFooWillChange: function (value) {
                expect(value).toBe(12);
            }
        };
        spyOn(object, "handleFooWillChange").and.callThrough();
        PropertyChanges.addBeforeOwnPropertyChangeListener(object, "foo", object);
        object.foo = 10;
        expect(object.handleFooWillChange).toHaveBeenCalled();
    });
    it("calls later handlers if earlier ones remove themselves", function () {
        var object = {
            foo: true
        };
        var listener1 = {
            handleFooChange: function (value, key, object) {
                PropertyChanges.removeOwnPropertyChangeListener(object, key, listener1);
            }
        };
        var listener2 = jasmine.createSpyObj("listener2", ["handleFooChange"]);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener1);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener2);
        object.foo = false;
        expect(listener2.handleFooChange).toHaveBeenCalled();
    });
    it("calls later handlers if multiple earlier ones remove themselves", function () {
        var object = {
            foo: true
        };
        var listener3 = {
            handleFooChange: function (value, key, object) {
                PropertyChanges.removeOwnPropertyChangeListener(object, key, listener1);
                PropertyChanges.removeOwnPropertyChangeListener(object, key, listener3);
            }
        };
        var listener1 = jasmine.createSpyObj("listener1", ["handleFooChange"]);
        var listener2 = jasmine.createSpyObj("listener2", ["handleFooChange"]);
        var listener4 = jasmine.createSpyObj("listener4", ["handleFooChange"]);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener1);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener2);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener3);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener4);
        object.foo = false;
        expect(listener1.handleFooChange).toHaveBeenCalled();
        expect(listener2.handleFooChange).toHaveBeenCalled();
        expect(listener4.handleFooChange).toHaveBeenCalled();
    });
    it("doesn't call any handlers if all the listeners are removed during dispatch", function () {
        var object = {
            foo: true
        };
        var listener1 = {
            handleFooChange: function (value, key, object) {
                PropertyChanges.removeOwnPropertyChangeListener(object, key, listener1);
                PropertyChanges.removeOwnPropertyChangeListener(object, key, listener2);
            }
        };
        var listener2 = jasmine.createSpyObj("listener2", ["handleFooChange"]);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener1);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener2);
        object.foo = false;
        expect(listener2.handleFooChange).not.toHaveBeenCalled();
    });
    it("doesn't call new handlers if listeners are added during dispatch", function () {
        var object = {
            foo: true
        };
        var listener1 = {
            handleFooChange: function (value, key, object) {
                PropertyChanges.removeOwnPropertyChangeListener(object, key, listener1);
                PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener3);
            }
        };
        var listener2 = jasmine.createSpyObj("listener2", ["handleFooChange"]);
        var listener3 = jasmine.createSpyObj("listener3", ["handleFooChange"]);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener1);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener2);
        object.foo = false;
        expect(listener2.handleFooChange).toHaveBeenCalled();
        expect(listener3.handleFooChange).not.toHaveBeenCalled();
    });
    it("compact listeners when the ratio of ListenerGhost is too high", function () {
        var object = {
            foo: true
        };
        var listener3 = {
            handleFooChange: function (value, key, object) {
                PropertyChanges.removeOwnPropertyChangeListener(object, key, listener1);
                PropertyChanges.removeOwnPropertyChangeListener(object, key, listener3);
                PropertyChanges.removeOwnPropertyChangeListener(object, key, listener5);
            }
        };
        var listener1 = jasmine.createSpyObj("listener1", ["handleFooChange"]);
        var listener2 = jasmine.createSpyObj("listener2", ["handleFooChange"]);
        var listener4 = jasmine.createSpyObj("listener4", ["handleFooChange"]);
        var listener5 = jasmine.createSpyObj("listener5", ["handleFooChange"]);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener1);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener2);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener3);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener4);
        PropertyChanges.addOwnPropertyChangeListener(object, "foo", listener5);
        object.foo = false;
        expect(listener1.handleFooChange).toHaveBeenCalled();
        expect(listener2.handleFooChange).toHaveBeenCalled();
        expect(listener4.handleFooChange).toHaveBeenCalled();
        var descriptor = PropertyChanges.getOwnPropertyChangeDescriptor(object, "foo");
        expect(descriptor.changeListeners.ghostCount).toEqual(3);
        object.foo = true;
        expect(descriptor.changeListeners.ghostCount).toEqual(0);
        expect(listener2.handleFooChange).toHaveBeenCalled();
        expect(listener4.handleFooChange).toHaveBeenCalled();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHktY2hhbmdlcy1zcGVjLmpzIiwic291cmNlUm9vdCI6Ii4vIiwic291cmNlcyI6WyJwYWNrYWdlcy9qcy1wcm90b3R5cGVzL3BhY2thZ2VzL2NvbGxlY3Rpb25zL3Rlc3Qvc3BlYy9saXN0ZW4vcHJvcGVydHktY2hhbmdlcy1zcGVjLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7RUFLRTtBQUVGLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQzVCLElBQUksZUFBZSxHQUFHLE9BQU8sQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDO0FBRXJFLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRTtJQUV4QixFQUFFLENBQUMsMkJBQTJCLEVBQUU7UUFDNUIsR0FBRyxHQUFHLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUMxQixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDaEIsZUFBZSxDQUFDLGtDQUFrQyxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsVUFBVSxLQUFLLEVBQUUsR0FBRztZQUNoRixHQUFHLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztRQUM1QixDQUFDLENBQUMsQ0FBQztRQUNILGVBQWUsQ0FBQyw0QkFBNEIsQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLFVBQVUsS0FBSyxFQUFFLEdBQUc7WUFDMUUsR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNkLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRTdCLElBQUksV0FBVyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLFVBQVUsSUFBSSxJQUFJLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQSxDQUFD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QVUsR0FBRyxlQUFlLENBQUMsOEJBQThCLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQy9FLE1BQU0sQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV6RCxNQUFNLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQztRQUNsQixNQUFNLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFekQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3JELE1BQU0sQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUV6RCxDQUFDLENBQUMsQ0FBQztBQUVQLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAgICBCYXNlZCBpbiBwYXJ0IG9uIG9ic2VydmFibGUgYXJyYXlzIGZyb20gTW90b3JvbGEgTW9iaWxpdHnigJlzIE1vbnRhZ2VcbiAgICBDb3B5cmlnaHQgKGMpIDIwMTIsIE1vdG9yb2xhIE1vYmlsaXR5IExMQy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAgICAzLUNsYXVzZSBCU0QgTGljZW5zZVxuICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9tb3Rvcm9sYS1tb2JpbGl0eS9tb250YWdlL2Jsb2IvbWFzdGVyL0xJQ0VOU0UubWRcbiovXG5cbnJlcXVpcmUoXCJjb2xsZWN0aW9ucy9zaGltXCIpO1xudmFyIFByb3BlcnR5Q2hhbmdlcyA9IHJlcXVpcmUoXCJjb2xsZWN0aW9ucy9saXN0ZW4vcHJvcGVydHktY2hhbmdlc1wiKTtcblxuZGVzY3JpYmUoXCJQcm9wZXJ0eUNoYW5nZXNcIiwgZnVuY3Rpb24gKCkge1xuXG4gICAgaXQoXCJvYnNlcnZlcyBzZXR0ZXIgb24gb2JqZWN0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3B5ID0gamFzbWluZS5jcmVhdGVTcHkoKTtcbiAgICAgICAgdmFyIG9iamVjdCA9IHt9O1xuICAgICAgICBQcm9wZXJ0eUNoYW5nZXMuYWRkQmVmb3JlT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsICd4JywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgIHNweSgnZnJvbScsIHZhbHVlLCBrZXkpO1xuICAgICAgICB9KTtcbiAgICAgICAgUHJvcGVydHlDaGFuZ2VzLmFkZE93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCAneCcsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICBzcHkoJ3RvJywgdmFsdWUsIGtleSk7XG4gICAgICAgIH0pO1xuICAgICAgICBvYmplY3QueCA9IDEwO1xuICAgICAgICBleHBlY3Qob2JqZWN0LngpLnRvRXF1YWwoMTApO1xuICAgICAgICBcbiAgICAgICAgdmFyIGFyZ3NGb3JDYWxsID0gc3B5LmNhbGxzLmFsbCgpLm1hcChmdW5jdGlvbiAoY2FsbCkgeyByZXR1cm4gY2FsbC5hcmdzIH0pO1xuICAgICAgICBleHBlY3QoYXJnc0ZvckNhbGwpLnRvRXF1YWwoW1xuICAgICAgICAgICAgWydmcm9tJywgdW5kZWZpbmVkLCAneCddLFxuICAgICAgICAgICAgWyd0bycsIDEwLCAneCddLFxuICAgICAgICBdKTtcbiAgICB9KTtcblxuICAgIGl0KFwib2JzZXJ2ZXMgc2V0dGVyIG9uIG9iamVjdCB3aXRoIGdldHRlci9zZXR0ZXJcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBzcHkgPSBqYXNtaW5lLmNyZWF0ZVNweSgpO1xuICAgICAgICB2YXIgdmFsdWU7XG4gICAgICAgIHZhciBvYmplY3QgPSBPYmplY3QuY3JlYXRlKE9iamVjdC5wcm90b3R5cGUsIHtcbiAgICAgICAgICAgIF94OiB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IDEwLFxuICAgICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeDoge1xuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5feDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKF92YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl94ID0gX3ZhbHVlO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBQcm9wZXJ0eUNoYW5nZXMuYWRkQmVmb3JlT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsICd4JywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgIHNweSgnZnJvbScsIHZhbHVlLCBrZXkpO1xuICAgICAgICB9KTtcbiAgICAgICAgUHJvcGVydHlDaGFuZ2VzLmFkZE93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCAneCcsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICBzcHkoJ3RvJywgdmFsdWUsIGtleSk7XG4gICAgICAgIH0pO1xuICAgICAgICBvYmplY3QueCA9IDIwO1xuICAgICAgICBleHBlY3Qob2JqZWN0LngpLnRvRXF1YWwoMjApO1xuXG4gICAgICAgIHZhciBhcmdzRm9yQ2FsbCA9IHNweS5jYWxscy5hbGwoKS5tYXAoZnVuY3Rpb24gKGNhbGwpIHsgcmV0dXJuIGNhbGwuYXJncyB9KTtcbiAgICAgICAgZXhwZWN0KGFyZ3NGb3JDYWxsKS50b0VxdWFsKFtcbiAgICAgICAgICAgIFsnZnJvbScsIDEwLCAneCddLFxuICAgICAgICAgICAgWyd0bycsIDIwLCAneCddLCAvLyByZXBvcnRzIG5vIGNoYW5nZVxuICAgICAgICBdKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkbid0IGNhbGwgdGhlIGxpc3RlbmVyIGlmIHRoZSBuZXcgdmFsdWUgaXMgdGhlIHNhbWUgYWZ0ZXIgY2FsbGluZyB0aGUgb2JqZWN0IHNldHRlclwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNweSA9IGphc21pbmUuY3JlYXRlU3B5KCk7XG4gICAgICAgIHZhciB2YWx1ZTtcbiAgICAgICAgdmFyIG9iamVjdCA9IE9iamVjdC5jcmVhdGUoT2JqZWN0LnByb3RvdHlwZSwge1xuICAgICAgICAgICAgeDoge1xuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjA7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChfdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVmdXNlIHRvIGNoYW5nZSBpbnRlcm5hbCBzdGF0ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBQcm9wZXJ0eUNoYW5nZXMuYWRkQmVmb3JlT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsICd4JywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgIHNweSgnZnJvbScsIHZhbHVlLCBrZXkpO1xuICAgICAgICB9KTtcbiAgICAgICAgUHJvcGVydHlDaGFuZ2VzLmFkZE93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCAneCcsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICBzcHkoJ3RvJywgdmFsdWUsIGtleSk7XG4gICAgICAgIH0pO1xuICAgICAgICBvYmplY3QueCA9IDEwO1xuICAgICAgICBleHBlY3Qob2JqZWN0LngpLnRvRXF1YWwoMjApO1xuICAgICAgICBleHBlY3Qoc3B5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJjYWxscyBzZXR0ZXIgb24gb2JqZWN0IHdoZW4gdGhlIG5ldyB2YWx1ZSBpcyB0aGUgY3VycmVudCB2YWx1ZVwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG9iamVjdCA9IE9iamVjdC5jcmVhdGUoT2JqZWN0LnByb3RvdHlwZSwge1xuICAgICAgICAgICAgX3g6IHt2YWx1ZTogMCwgd3JpdGFibGU6IHRydWV9LFxuICAgICAgICAgICAgeDoge1xuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl94O1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl94ID0gdmFsdWUgKiAyO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgUHJvcGVydHlDaGFuZ2VzLmFkZE93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCBcInhcIiwgZnVuY3Rpb24oKSB7fSk7XG5cbiAgICAgICAgb2JqZWN0LnggPSAxO1xuICAgICAgICBvYmplY3QueCA9IDI7XG5cbiAgICAgICAgZXhwZWN0KG9iamVjdC54KS50b0JlKDQpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJoYW5kbGVzIGN5Y2xpYyBvd24gcHJvcGVydHkgY2hhbmdlIGxpc3RlbmVyc1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhID0ge307XG4gICAgICAgIHZhciBiID0ge307XG4gICAgICAgIFByb3BlcnR5Q2hhbmdlcy5hZGRPd25Qcm9wZXJ0eUNoYW5nZUxpc3RlbmVyKGEsICdmb28nLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGIuYmFyID0gdmFsdWU7XG4gICAgICAgIH0pO1xuICAgICAgICBQcm9wZXJ0eUNoYW5nZXMuYWRkT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihiLCAnYmFyJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBhLmZvbyA9IHZhbHVlO1xuICAgICAgICB9KTtcbiAgICAgICAgYS5mb28gPSAxMDtcbiAgICAgICAgZXhwZWN0KGIuYmFyKS50b0VxdWFsKDEwKTtcbiAgICB9KTtcblxuICAgIGl0KFwiaGFuZGxlcyBnZW5lcmljIG93biBwcm9wZXJ0eSBjaGFuZ2UgbGlzdGVuZXJzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG9iamVjdCA9IHtcbiAgICAgICAgICAgIGhhbmRsZVByb3BlcnR5Q2hhbmdlOiBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xuICAgICAgICAgICAgICAgIGV4cGVjdCh2YWx1ZSkudG9CZSgxMCk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGtleSkudG9CZShcImZvb1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgc3B5T24ob2JqZWN0LCBcImhhbmRsZVByb3BlcnR5Q2hhbmdlXCIpLmFuZC5jYWxsVGhyb3VnaCgpO1xuICAgICAgICBQcm9wZXJ0eUNoYW5nZXMuYWRkT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsIFwiZm9vXCIsIG9iamVjdCk7XG4gICAgICAgIG9iamVjdC5mb28gPSAxMDtcbiAgICAgICAgZXhwZWN0KG9iamVjdC5oYW5kbGVQcm9wZXJ0eUNoYW5nZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJoYW5kbGVzIGdlbmVyaWMgYmVmb3JlIG93biBwcm9wZXJ0eSBjaGFuZ2UgbGlzdGVuZXJzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG9iamVjdCA9IHtcbiAgICAgICAgICAgIGZvbzogMTIsXG4gICAgICAgICAgICBoYW5kbGVQcm9wZXJ0eVdpbGxDaGFuZ2U6IGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHZhbHVlKS50b0JlKDEyKTtcbiAgICAgICAgICAgICAgICBleHBlY3Qoa2V5KS50b0JlKFwiZm9vXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBzcHlPbihvYmplY3QsIFwiaGFuZGxlUHJvcGVydHlXaWxsQ2hhbmdlXCIpLmFuZC5jYWxsVGhyb3VnaCgpO1xuICAgICAgICBQcm9wZXJ0eUNoYW5nZXMuYWRkQmVmb3JlT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsIFwiZm9vXCIsIG9iamVjdCk7XG4gICAgICAgIG9iamVjdC5mb28gPSAxMDtcbiAgICAgICAgZXhwZWN0KG9iamVjdC5oYW5kbGVQcm9wZXJ0eVdpbGxDaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KFwiaGFuZGxlcyBzcGVjaWZpYyBvd24gcHJvcGVydHkgY2hhbmdlIGxpc3RlbmVyc1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvYmplY3QgPSB7XG4gICAgICAgICAgICBoYW5kbGVGb29DaGFuZ2U6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGV4cGVjdCh2YWx1ZSkudG9CZSgxMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHNweU9uKG9iamVjdCwgXCJoYW5kbGVGb29DaGFuZ2VcIikuYW5kLmNhbGxUaHJvdWdoKCk7XG4gICAgICAgIFByb3BlcnR5Q2hhbmdlcy5hZGRPd25Qcm9wZXJ0eUNoYW5nZUxpc3RlbmVyKG9iamVjdCwgXCJmb29cIiwgb2JqZWN0KTtcbiAgICAgICAgb2JqZWN0LmZvbyA9IDEwO1xuICAgICAgICBleHBlY3Qob2JqZWN0LmhhbmRsZUZvb0NoYW5nZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJoYW5kbGVzIHNwZWNpZmljIGJlZm9yZSBvd24gcHJvcGVydHkgY2hhbmdlIGxpc3RlbmVyc1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvYmplY3QgPSB7XG4gICAgICAgICAgICBmb286IDEyLFxuICAgICAgICAgICAgaGFuZGxlRm9vV2lsbENoYW5nZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHZhbHVlKS50b0JlKDEyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgc3B5T24ob2JqZWN0LCBcImhhbmRsZUZvb1dpbGxDaGFuZ2VcIikuYW5kLmNhbGxUaHJvdWdoKCk7XG4gICAgICAgIFByb3BlcnR5Q2hhbmdlcy5hZGRCZWZvcmVPd25Qcm9wZXJ0eUNoYW5nZUxpc3RlbmVyKG9iamVjdCwgXCJmb29cIiwgb2JqZWN0KTtcbiAgICAgICAgb2JqZWN0LmZvbyA9IDEwO1xuICAgICAgICBleHBlY3Qob2JqZWN0LmhhbmRsZUZvb1dpbGxDaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KFwiY2FsbHMgbGF0ZXIgaGFuZGxlcnMgaWYgZWFybGllciBvbmVzIHJlbW92ZSB0aGVtc2VsdmVzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG9iamVjdCA9IHtcbiAgICAgICAgICAgIGZvbzogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICB2YXIgbGlzdGVuZXIxID0ge1xuICAgICAgICAgICAgaGFuZGxlRm9vQ2hhbmdlOiBmdW5jdGlvbiAodmFsdWUsIGtleSwgb2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgUHJvcGVydHlDaGFuZ2VzLnJlbW92ZU93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCBrZXksIGxpc3RlbmVyMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBsaXN0ZW5lcjIgPSBqYXNtaW5lLmNyZWF0ZVNweU9iaihcImxpc3RlbmVyMlwiLCBbXCJoYW5kbGVGb29DaGFuZ2VcIl0pO1xuXG4gICAgICAgIFByb3BlcnR5Q2hhbmdlcy5hZGRPd25Qcm9wZXJ0eUNoYW5nZUxpc3RlbmVyKG9iamVjdCwgXCJmb29cIiwgbGlzdGVuZXIxKTtcbiAgICAgICAgUHJvcGVydHlDaGFuZ2VzLmFkZE93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCBcImZvb1wiLCBsaXN0ZW5lcjIpO1xuXG4gICAgICAgIG9iamVjdC5mb28gPSBmYWxzZTtcbiAgICAgICAgZXhwZWN0KGxpc3RlbmVyMi5oYW5kbGVGb29DaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KFwiY2FsbHMgbGF0ZXIgaGFuZGxlcnMgaWYgbXVsdGlwbGUgZWFybGllciBvbmVzIHJlbW92ZSB0aGVtc2VsdmVzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG9iamVjdCA9IHtcbiAgICAgICAgICAgIGZvbzogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICB2YXIgbGlzdGVuZXIzID0ge1xuICAgICAgICAgICAgaGFuZGxlRm9vQ2hhbmdlOiBmdW5jdGlvbiAodmFsdWUsIGtleSwgb2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgUHJvcGVydHlDaGFuZ2VzLnJlbW92ZU93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCBrZXksIGxpc3RlbmVyMSk7XG4gICAgICAgICAgICAgICAgUHJvcGVydHlDaGFuZ2VzLnJlbW92ZU93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCBrZXksIGxpc3RlbmVyMyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBsaXN0ZW5lcjEgPSBqYXNtaW5lLmNyZWF0ZVNweU9iaihcImxpc3RlbmVyMVwiLCBbXCJoYW5kbGVGb29DaGFuZ2VcIl0pO1xuICAgICAgICB2YXIgbGlzdGVuZXIyID0gamFzbWluZS5jcmVhdGVTcHlPYmooXCJsaXN0ZW5lcjJcIiwgW1wiaGFuZGxlRm9vQ2hhbmdlXCJdKTtcbiAgICAgICAgdmFyIGxpc3RlbmVyNCA9IGphc21pbmUuY3JlYXRlU3B5T2JqKFwibGlzdGVuZXI0XCIsIFtcImhhbmRsZUZvb0NoYW5nZVwiXSk7XG5cbiAgICAgICAgUHJvcGVydHlDaGFuZ2VzLmFkZE93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCBcImZvb1wiLCBsaXN0ZW5lcjEpO1xuICAgICAgICBQcm9wZXJ0eUNoYW5nZXMuYWRkT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsIFwiZm9vXCIsIGxpc3RlbmVyMik7XG4gICAgICAgIFByb3BlcnR5Q2hhbmdlcy5hZGRPd25Qcm9wZXJ0eUNoYW5nZUxpc3RlbmVyKG9iamVjdCwgXCJmb29cIiwgbGlzdGVuZXIzKTtcbiAgICAgICAgUHJvcGVydHlDaGFuZ2VzLmFkZE93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCBcImZvb1wiLCBsaXN0ZW5lcjQpO1xuXG4gICAgICAgIG9iamVjdC5mb28gPSBmYWxzZTtcbiAgICAgICAgZXhwZWN0KGxpc3RlbmVyMS5oYW5kbGVGb29DaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KGxpc3RlbmVyMi5oYW5kbGVGb29DaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KGxpc3RlbmVyNC5oYW5kbGVGb29DaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KFwiZG9lc24ndCBjYWxsIGFueSBoYW5kbGVycyBpZiBhbGwgdGhlIGxpc3RlbmVycyBhcmUgcmVtb3ZlZCBkdXJpbmcgZGlzcGF0Y2hcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb2JqZWN0ID0ge1xuICAgICAgICAgICAgZm9vOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIHZhciBsaXN0ZW5lcjEgPSB7XG4gICAgICAgICAgICBoYW5kbGVGb29DaGFuZ2U6IGZ1bmN0aW9uICh2YWx1ZSwga2V5LCBvYmplY3QpIHtcbiAgICAgICAgICAgICAgICBQcm9wZXJ0eUNoYW5nZXMucmVtb3ZlT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsIGtleSwgbGlzdGVuZXIxKTtcbiAgICAgICAgICAgICAgICBQcm9wZXJ0eUNoYW5nZXMucmVtb3ZlT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsIGtleSwgbGlzdGVuZXIyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGxpc3RlbmVyMiA9IGphc21pbmUuY3JlYXRlU3B5T2JqKFwibGlzdGVuZXIyXCIsIFtcImhhbmRsZUZvb0NoYW5nZVwiXSk7XG5cbiAgICAgICAgUHJvcGVydHlDaGFuZ2VzLmFkZE93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCBcImZvb1wiLCBsaXN0ZW5lcjEpO1xuICAgICAgICBQcm9wZXJ0eUNoYW5nZXMuYWRkT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsIFwiZm9vXCIsIGxpc3RlbmVyMik7XG5cbiAgICAgICAgb2JqZWN0LmZvbyA9IGZhbHNlO1xuICAgICAgICBleHBlY3QobGlzdGVuZXIyLmhhbmRsZUZvb0NoYW5nZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KFwiZG9lc24ndCBjYWxsIG5ldyBoYW5kbGVycyBpZiBsaXN0ZW5lcnMgYXJlIGFkZGVkIGR1cmluZyBkaXNwYXRjaFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvYmplY3QgPSB7XG4gICAgICAgICAgICBmb286IHRydWVcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGxpc3RlbmVyMSA9IHtcbiAgICAgICAgICAgIGhhbmRsZUZvb0NoYW5nZTogZnVuY3Rpb24gKHZhbHVlLCBrZXksIG9iamVjdCkge1xuICAgICAgICAgICAgICAgIFByb3BlcnR5Q2hhbmdlcy5yZW1vdmVPd25Qcm9wZXJ0eUNoYW5nZUxpc3RlbmVyKG9iamVjdCwga2V5LCBsaXN0ZW5lcjEpO1xuICAgICAgICAgICAgICAgIFByb3BlcnR5Q2hhbmdlcy5hZGRPd25Qcm9wZXJ0eUNoYW5nZUxpc3RlbmVyKG9iamVjdCwgXCJmb29cIiwgbGlzdGVuZXIzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGxpc3RlbmVyMiA9IGphc21pbmUuY3JlYXRlU3B5T2JqKFwibGlzdGVuZXIyXCIsIFtcImhhbmRsZUZvb0NoYW5nZVwiXSk7XG4gICAgICAgIHZhciBsaXN0ZW5lcjMgPSBqYXNtaW5lLmNyZWF0ZVNweU9iaihcImxpc3RlbmVyM1wiLCBbXCJoYW5kbGVGb29DaGFuZ2VcIl0pO1xuXG4gICAgICAgIFByb3BlcnR5Q2hhbmdlcy5hZGRPd25Qcm9wZXJ0eUNoYW5nZUxpc3RlbmVyKG9iamVjdCwgXCJmb29cIiwgbGlzdGVuZXIxKTtcbiAgICAgICAgUHJvcGVydHlDaGFuZ2VzLmFkZE93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCBcImZvb1wiLCBsaXN0ZW5lcjIpO1xuXG4gICAgICAgIG9iamVjdC5mb28gPSBmYWxzZTtcbiAgICAgICAgZXhwZWN0KGxpc3RlbmVyMi5oYW5kbGVGb29DaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KGxpc3RlbmVyMy5oYW5kbGVGb29DaGFuZ2UpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdChcImNvbXBhY3QgbGlzdGVuZXJzIHdoZW4gdGhlIHJhdGlvIG9mIExpc3RlbmVyR2hvc3QgaXMgdG9vIGhpZ2hcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb2JqZWN0ID0ge1xuICAgICAgICAgICAgZm9vOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIHZhciBsaXN0ZW5lcjMgPSB7XG4gICAgICAgICAgICBoYW5kbGVGb29DaGFuZ2U6IGZ1bmN0aW9uICh2YWx1ZSwga2V5LCBvYmplY3QpIHtcbiAgICAgICAgICAgICAgICBQcm9wZXJ0eUNoYW5nZXMucmVtb3ZlT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsIGtleSwgbGlzdGVuZXIxKTtcbiAgICAgICAgICAgICAgICBQcm9wZXJ0eUNoYW5nZXMucmVtb3ZlT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsIGtleSwgbGlzdGVuZXIzKTtcbiAgICAgICAgICAgICAgICBQcm9wZXJ0eUNoYW5nZXMucmVtb3ZlT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsIGtleSwgbGlzdGVuZXI1KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGxpc3RlbmVyMSA9IGphc21pbmUuY3JlYXRlU3B5T2JqKFwibGlzdGVuZXIxXCIsIFtcImhhbmRsZUZvb0NoYW5nZVwiXSk7XG4gICAgICAgIHZhciBsaXN0ZW5lcjIgPSBqYXNtaW5lLmNyZWF0ZVNweU9iaihcImxpc3RlbmVyMlwiLCBbXCJoYW5kbGVGb29DaGFuZ2VcIl0pO1xuICAgICAgICB2YXIgbGlzdGVuZXI0ID0gamFzbWluZS5jcmVhdGVTcHlPYmooXCJsaXN0ZW5lcjRcIiwgW1wiaGFuZGxlRm9vQ2hhbmdlXCJdKTtcbiAgICAgICAgdmFyIGxpc3RlbmVyNSA9IGphc21pbmUuY3JlYXRlU3B5T2JqKFwibGlzdGVuZXI1XCIsIFtcImhhbmRsZUZvb0NoYW5nZVwiXSk7XG5cbiAgICAgICAgUHJvcGVydHlDaGFuZ2VzLmFkZE93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCBcImZvb1wiLCBsaXN0ZW5lcjEpO1xuICAgICAgICBQcm9wZXJ0eUNoYW5nZXMuYWRkT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsIFwiZm9vXCIsIGxpc3RlbmVyMik7XG4gICAgICAgIFByb3BlcnR5Q2hhbmdlcy5hZGRPd25Qcm9wZXJ0eUNoYW5nZUxpc3RlbmVyKG9iamVjdCwgXCJmb29cIiwgbGlzdGVuZXIzKTtcbiAgICAgICAgUHJvcGVydHlDaGFuZ2VzLmFkZE93blByb3BlcnR5Q2hhbmdlTGlzdGVuZXIob2JqZWN0LCBcImZvb1wiLCBsaXN0ZW5lcjQpO1xuICAgICAgICBQcm9wZXJ0eUNoYW5nZXMuYWRkT3duUHJvcGVydHlDaGFuZ2VMaXN0ZW5lcihvYmplY3QsIFwiZm9vXCIsIGxpc3RlbmVyNSk7XG5cbiAgICAgICAgb2JqZWN0LmZvbyA9IGZhbHNlO1xuICAgICAgICBleHBlY3QobGlzdGVuZXIxLmhhbmRsZUZvb0NoYW5nZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICBleHBlY3QobGlzdGVuZXIyLmhhbmRsZUZvb0NoYW5nZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICBleHBlY3QobGlzdGVuZXI0LmhhbmRsZUZvb0NoYW5nZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuXG4gICAgICAgIHZhciBkZXNjcmlwdG9yID0gUHJvcGVydHlDaGFuZ2VzLmdldE93blByb3BlcnR5Q2hhbmdlRGVzY3JpcHRvcihvYmplY3QsIFwiZm9vXCIpO1xuICAgICAgICBleHBlY3QoZGVzY3JpcHRvci5jaGFuZ2VMaXN0ZW5lcnMuZ2hvc3RDb3VudCkudG9FcXVhbCgzKTtcblxuICAgICAgICBvYmplY3QuZm9vID0gdHJ1ZTtcbiAgICAgICAgZXhwZWN0KGRlc2NyaXB0b3IuY2hhbmdlTGlzdGVuZXJzLmdob3N0Q291bnQpLnRvRXF1YWwoMCk7XG5cbiAgICAgICAgZXhwZWN0KGxpc3RlbmVyMi5oYW5kbGVGb29DaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KGxpc3RlbmVyNC5oYW5kbGVGb29DaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcblxuICAgIH0pO1xuXG59KTtcbiJdfQ==