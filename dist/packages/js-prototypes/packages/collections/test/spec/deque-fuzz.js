"use strict";
var Deque = require("collections/deque");
require("collections/shim-array");
var prng = require("./prng");
exports.fuzzDeque = fuzzDeque;
function fuzzDeque(Deque) {
    describe('fuzz', function () {
        it("should pass deque fuzz", function () {
            for (var biasWeight = .3; biasWeight < .8; biasWeight += .2) {
                for (var maxAddLength = 1; maxAddLength < 5; maxAddLength += 3) {
                    for (var seed = 0; seed < 10; seed++) {
                        var plan = makePlan(100, seed, biasWeight, maxAddLength);
                        execute(Deque, plan.ops);
                    }
                }
            }
        });
    });
}
exports.makePlan = makePlan;
function makePlan(length, seed, biasWeight, maxAddLength) {
    maxAddLength = maxAddLength || 1;
    var random = prng(seed);
    var ops = [];
    while (ops.length < length) {
        var bias = ops.length / length;
        var choice1 = random() * (1 - biasWeight) + bias * biasWeight;
        var choice2 = random();
        if (choice1 < 1 / (maxAddLength + 1)) {
            if (choice2 < .5) {
                ops.push(["push", makeRandomArray(1 + ~~(random() * maxAddLength - .5))]);
            }
            else {
                ops.push(["unshift", makeRandomArray(1 + ~~(random() * maxAddLength - .5))]);
            }
        }
        else {
            if (choice2 < .5) {
                ops.push(["shift", []]);
            }
            else {
                ops.push(["pop", []]);
            }
        }
    }
    return {
        seed: seed,
        length: length,
        biasWeight: biasWeight,
        maxAddLength: maxAddLength,
        ops: ops
    };
}
function makeRandomArray(length, random) {
    var array = [];
    for (var index = 0; index < length; index++) {
        array.push(~~(Math.random() * 100));
    }
    return array;
}
exports.execute = execute;
function execute(Collection, ops) {
    var oracle = [];
    var actual = new Collection();
    ops.forEach(function (op) {
        executeOp(oracle, op);
        executeOp(actual, op);
        if (typeof expect === "function") {
            expect(actual.toArray()).toEqual(oracle);
        }
        else if (!actual.toArray().equals(oracle)) {
            console.log(actual.front, actual.toArray(), oracle);
            throw new Error("Did not match after " + stringifyOp(op));
        }
    });
}
exports.executeOp = executeOp;
function executeOp(collection, op) {
    collection[op[0]].apply(collection, op[1]);
}
exports.stringify = stringify;
function stringify(ops) {
    return ops.map(stringifyOp).join(" ");
}
exports.stringifyOp = stringifyOp;
function stringifyOp(op) {
    return op[0] + "(" + op[1].join(", ") + ")";
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVxdWUtZnV6ei5qcyIsInNvdXJjZVJvb3QiOiIuLyIsInNvdXJjZXMiOlsicGFja2FnZXMvanMtcHJvdG90eXBlcy9wYWNrYWdlcy9jb2xsZWN0aW9ucy90ZXN0L3NwZWMvZGVxdWUtZnV6ei5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUM7QUFDekMsT0FBTyxDQUFDLHdCQUF3QixDQUFDLENBQUM7QUFDbEMsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBRTdCLE9BQU8sQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO0FBQzlCLFNBQVMsU0FBUyxDQUFDLEtBQUs7SUFDcEIsUUFBUSxDQUFDLE1BQU0sRUFBRTtRQUNiLEVBQUUsQ0FBRSx3QkFBd0IsRUFBRTtZQUMxQixLQUFLLElBQUksVUFBVSxHQUFHLEVBQUUsRUFBRSxVQUFVLEdBQUcsRUFBRSxFQUFFLFVBQVUsSUFBSSxFQUFFLEVBQUU7Z0JBQ3pELEtBQUssSUFBSSxZQUFZLEdBQUcsQ0FBQyxFQUFFLFlBQVksR0FBRyxDQUFDLEVBQUUsWUFBWSxJQUFJLENBQUMsRUFBRTtvQkFDNUQsS0FBSyxJQUFJLElBQUksR0FBRyxDQUFDLEVBQUUsSUFBSSxHQUFHLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRTt3QkFDbEMsSUFBSSxJQUFJLEdBQUcsUUFBUSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDO3dCQUNyRCxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztxQkFDaEM7aUJBQ0o7YUFDSjtRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBRUQsT0FBTyxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7QUFDNUIsU0FBUyxRQUFRLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxV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QUUsTUFBTSxDQUFDLENBQUM7WUFDcEQsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsR0FBRyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUM3RDtJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQztBQUVELE9BQU8sQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO0FBQzlCLFNBQVMsU0FBUyxDQUFDLFVBQVUsRUFBRSxFQUFFO0lBQzdCLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQy9DLENBQUM7QUFFRCxPQUFPLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztBQUM5QixTQUFTLFNBQVMsQ0FBQyxHQUFHO0lBQ2xCLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDMUMsQ0FBQztBQUVELE9BQU8sQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO0FBQ2xDLFNBQVMsV0FBVyxDQUFDLEVBQUU7SUFDbkIsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDO0FBQ2hELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcbnZhciBEZXF1ZSA9IHJlcXVpcmUoXCJjb2xsZWN0aW9ucy9kZXF1ZVwiKTtcbnJlcXVpcmUoXCJjb2xsZWN0aW9ucy9zaGltLWFycmF5XCIpO1xudmFyIHBybmcgPSByZXF1aXJlKFwiLi9wcm5nXCIpO1xuXG5leHBvcnRzLmZ1enpEZXF1ZSA9IGZ1enpEZXF1ZTtcbmZ1bmN0aW9uIGZ1enpEZXF1ZShEZXF1ZSkge1xuICAgIGRlc2NyaWJlKCdmdXp6JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpdCAoXCJzaG91bGQgcGFzcyBkZXF1ZSBmdXp6XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGJpYXNXZWlnaHQgPSAuMzsgYmlhc1dlaWdodCA8IC44OyBiaWFzV2VpZ2h0ICs9IC4yKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbWF4QWRkTGVuZ3RoID0gMTsgbWF4QWRkTGVuZ3RoIDwgNTsgbWF4QWRkTGVuZ3RoICs9IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgc2VlZCA9IDA7IHNlZWQgPCAxMDsgc2VlZCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGxhbiA9IG1ha2VQbGFuKDEwMCwgc2VlZCwgYmlhc1dlaWdodCwgbWF4QWRkTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGVjdXRlKERlcXVlLCBwbGFuLm9wcyk7IFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5cbmV4cG9ydHMubWFrZVBsYW4gPSBtYWtlUGxhbjtcbmZ1bmN0aW9uIG1ha2VQbGFuKGxlbmd0aCwgc2VlZCwgYmlhc1dlaWdodCwgbWF4QWRkTGVuZ3RoKSB7XG4gICAgbWF4QWRkTGVuZ3RoID0gbWF4QWRkTGVuZ3RoIHx8IDE7XG4gICAgdmFyIHJhbmRvbSA9IHBybmcoc2VlZCk7XG4gICAgdmFyIG9wcyA9IFtdO1xuICAgIHdoaWxlIChvcHMubGVuZ3RoIDwgbGVuZ3RoKSB7XG4gICAgICAgIHZhciBiaWFzID0gb3BzLmxlbmd0aCAvIGxlbmd0aDtcbiAgICAgICAgdmFyIGNob2ljZTEgPSByYW5kb20oKSAqICgxIC0gYmlhc1dlaWdodCkgKyBiaWFzICogYmlhc1dlaWdodDtcbiAgICAgICAgdmFyIGNob2ljZTIgPSByYW5kb20oKTtcbiAgICAgICAgaWYgKGNob2ljZTEgPCAxIC8gKG1heEFkZExlbmd0aCArIDEpKSB7XG4gICAgICAgICAgICBpZiAoY2hvaWNlMiA8IC41KSB7XG4gICAgICAgICAgICAgICAgb3BzLnB1c2goW1wicHVzaFwiLCBtYWtlUmFuZG9tQXJyYXkoMSArIH5+KHJhbmRvbSgpICogbWF4QWRkTGVuZ3RoIC0gLjUpKV0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvcHMucHVzaChbXCJ1bnNoaWZ0XCIsIG1ha2VSYW5kb21BcnJheSgxICsgfn4ocmFuZG9tKCkgKiBtYXhBZGRMZW5ndGggLSAuNSkpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoY2hvaWNlMiA8IC41KSB7XG4gICAgICAgICAgICAgICAgb3BzLnB1c2goW1wic2hpZnRcIiwgW11dKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb3BzLnB1c2goW1wicG9wXCIsIFtdXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2VlZDogc2VlZCxcbiAgICAgICAgbGVuZ3RoOiBsZW5ndGgsXG4gICAgICAgIGJpYXNXZWlnaHQ6IGJpYXNXZWlnaHQsXG4gICAgICAgIG1heEFkZExlbmd0aDogbWF4QWRkTGVuZ3RoLFxuICAgICAgICBvcHM6IG9wc1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbWFrZVJhbmRvbUFycmF5KGxlbmd0aCwgcmFuZG9tKSB7XG4gICAgdmFyIGFycmF5ID0gW107XG4gICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICBhcnJheS5wdXNoKH5+KE1hdGgucmFuZG9tKCkgKiAxMDApKTtcbiAgICB9XG4gICAgcmV0dXJuIGFycmF5O1xufVxuXG5leHBvcnRzLmV4ZWN1dGUgPSBleGVjdXRlO1xuZnVuY3Rpb24gZXhlY3V0ZShDb2xsZWN0aW9uLCBvcHMpIHtcbiAgICB2YXIgb3JhY2xlID0gW107XG4gICAgdmFyIGFjdHVhbCA9IG5ldyBDb2xsZWN0aW9uKCk7XG4gICAgb3BzLmZvckVhY2goZnVuY3Rpb24gKG9wKSB7XG4gICAgICAgIGV4ZWN1dGVPcChvcmFjbGUsIG9wKTtcbiAgICAgICAgZXhlY3V0ZU9wKGFjdHVhbCwgb3ApO1xuICAgICAgICBpZiAodHlwZW9mIGV4cGVjdCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICBleHBlY3QoYWN0dWFsLnRvQXJyYXkoKSkudG9FcXVhbChvcmFjbGUpO1xuICAgICAgICB9IGVsc2UgaWYgKCFhY3R1YWwudG9BcnJheSgpLmVxdWFscyhvcmFjbGUpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhY3R1YWwuZnJvbnQsIGFjdHVhbC50b0FycmF5KCksIG9yYWNsZSk7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEaWQgbm90IG1hdGNoIGFmdGVyIFwiICsgc3RyaW5naWZ5T3Aob3ApKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5leHBvcnRzLmV4ZWN1dGVPcCA9IGV4ZWN1dGVPcDtcbmZ1bmN0aW9uIGV4ZWN1dGVPcChjb2xsZWN0aW9uLCBvcCkge1xuICAgIGNvbGxlY3Rpb25bb3BbMF1dLmFwcGx5KGNvbGxlY3Rpb24sIG9wWzFdKTtcbn1cblxuZXhwb3J0cy5zdHJpbmdpZnkgPSBzdHJpbmdpZnk7XG5mdW5jdGlvbiBzdHJpbmdpZnkob3BzKSB7XG4gICAgcmV0dXJuIG9wcy5tYXAoc3RyaW5naWZ5T3ApLmpvaW4oXCIgXCIpO1xufVxuXG5leHBvcnRzLnN0cmluZ2lmeU9wID0gc3RyaW5naWZ5T3A7XG5mdW5jdGlvbiBzdHJpbmdpZnlPcChvcCkge1xuICAgIHJldHVybiBvcFswXSArIFwiKFwiICsgb3BbMV0uam9pbihcIiwgXCIpICsgXCIpXCI7XG59XG5cbiJdfQ==