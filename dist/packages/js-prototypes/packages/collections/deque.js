"use strict";
require("./shim-object");
var GenericCollection = require("./generic-collection");
var GenericOrder = require("./generic-order");
var RangeChanges = require("./listen/range-changes");
// by Petka Antonov
// https://github.com/petkaantonov/deque/blob/master/js/deque.js
// Deque specifically uses
// http://en.wikipedia.org/wiki/Circular_buffer#Use_a_Fill_Count
// 1. Incrementally maintained length
// 2. Modulus avoided by using only powers of two for the capacity
module.exports = Deque;
function Deque(values, capacity) {
    if (!(this instanceof Deque)) {
        return new Deque(values, capacity);
    }
    this.capacity = this.snap(capacity);
    this.init();
    this.length = 0;
    this.front = 0;
    this.addEach(values);
}
Object.addEach(Deque.prototype, GenericCollection.prototype);
Object.addEach(Deque.prototype, GenericOrder.prototype);
Object.addEach(Deque.prototype, RangeChanges.prototype);
Deque.from = GenericCollection.from;
Deque.prototype.maxCapacity = (1 << 30) | 0;
Deque.prototype.minCapacity = 16;
Deque.prototype.constructClone = function (values) {
    return new this.constructor(values, this.capacity);
};
Deque.prototype.add = function (value) {
    this.push(value);
};
Deque.prototype.push = function (value /* or ...values */) {
    var argsLength = arguments.length;
    var length = this.length;
    if (this.dispatchesRangeChanges) {
        var plus = new Array(argsLength);
        for (var argIndex = 0; argIndex < argsLength; ++argIndex) {
            plus[argIndex] = arguments[argIndex];
        }
        var minus = [];
        this.dispatchBeforeRangeChange(plus, minus, length);
    }
    if (argsLength > 1) {
        var capacity = this.capacity;
        if (length + argsLength > capacity) {
            for (var argIndex = 0; argIndex < argsLength; ++argIndex) {
                this.ensureCapacity(length + 1);
                var j = (this.front + length) & (this.capacity - 1);
                this[j] = arguments[argIndex];
                length++;
                this.length = length;
            }
        }
        else {
            var j = this.front;
            for (var argIndex = 0; argIndex < argsLength; ++argIndex) {
                this[(j + length) & (capacity - 1)] = arguments[argIndex];
                j++;
            }
            this.length = length + argsLength;
        }
    }
    else if (argsLength === 1) {
        this.ensureCapacity(length + 1);
        var index = (this.front + length) & (this.capacity - 1);
        this[index] = value;
        this.length = length + 1;
    }
    if (this.dispatchesRangeChanges) {
        this.dispatchRangeChange(plus, minus, length);
    }
    return this.length;
};
Deque.prototype.pop = function () {
    var length = this.length;
    if (length === 0) {
        return;
    }
    var index = (this.front + length - 1) & (this.capacity - 1);
    var result = this[index];
    if (this.dispatchesRangeChanges) {
        this.dispatchBeforeRangeChange([], [result], length - 1);
    }
    this[index] = void 0;
    this.length = length - 1;
    if (this.dispatchesRangeChanges) {
        this.dispatchRangeChange([], [result], length - 1);
    }
    return result;
};
Deque.prototype.shift = function () {
    if (this.length !== 0) {
        var front = this.front;
        var result = this[front];
        if (this.dispatchesRangeChanges) {
            this.dispatchBeforeRangeChange([], [result], 0);
        }
        this[front] = void 0;
        this.front = (front + 1) & (this.capacity - 1);
        this.length--;
        if (this.dispatchesRangeChanges) {
            this.dispatchRangeChange([], [result], 0);
        }
        return result;
    }
};
Deque.prototype.unshift = function (value /* or ...values */) {
    var length = this.length;
    var argsLength = arguments.length;
    if (this.dispatchesRangeChanges) {
        var plus = new Array(argsLength);
        for (var argIndex = 0; argIndex < argsLength; ++argIndex) {
            plus[argIndex] = arguments[argIndex];
        }
        var minus = [];
        this.dispatchBeforeRangeChange(plus, minus, 0);
    }
    if (argsLength > 1) {
        var capacity = this.capacity;
        if (length + argsLength > capacity) {
            for (var argIndex = argsLength - 1; argIndex >= 0; argIndex--) {
                this.ensureCapacity(length + 1);
                var capacity = this.capacity;
                var index = ((((this.front - 1) &
                    (capacity - 1)) ^ capacity) - capacity);
                this[index] = arguments[argIndex];
                length++;
                this.front = index;
                this.length = length;
            }
        }
        else {
            var front = this.front;
            for (var argIndex = argsLength - 1; argIndex >= 0; argIndex--) {
                var index = ((((front - 1) &
                    (capacity - 1)) ^ capacity) - capacity);
                this[index] = arguments[argIndex];
                front = index;
            }
            this.front = front;
            this.length = length + argsLength;
        }
    }
    else if (argsLength === 1) {
        this.ensureCapacity(length + 1);
        var capacity = this.capacity;
        var index = ((((this.front - 1) &
            (capacity - 1)) ^ capacity) - capacity);
        this[index] = value;
        this.length = length + 1;
        this.front = index;
    }
    if (this.dispatchesRangeChanges) {
        this.dispatchRangeChange(plus, minus, 0);
    }
    return this.length;
};
Deque.prototype.clear = function () {
    this.length = 0;
    this.front = 0;
    this.init();
};
Deque.prototype.ensureCapacity = function (capacity) {
    if (this.capacity < capacity) {
        this.grow(this.snap(this.capacity * 1.5 + 16));
    }
};
Deque.prototype.grow = function (capacity) {
    var oldFront = this.front;
    var oldCapacity = this.capacity;
    var oldContent = new Array(oldCapacity);
    var length = this.length;
    copy(this, 0, oldContent, 0, oldCapacity);
    this.capacity = capacity;
    this.init();
    this.front = 0;
    if (oldFront + length <= oldCapacity) {
        // Can perform direct linear copy.
        copy(oldContent, oldFront, this, 0, length);
    }
    else {
        // Cannot perform copy directly, perform as much as possible at the
        // end, and then copy the rest to the beginning of the buffer.
        var lengthBeforeWrapping = length - ((oldFront + length) & (oldCapacity - 1));
        copy(oldContent, oldFront, this, 0, lengthBeforeWrapping);
        copy(oldContent, 0, this, lengthBeforeWrapping, length - lengthBeforeWrapping);
    }
};
Deque.prototype.init = function () {
    for (var index = 0; index < this.capacity; ++index) {
        this[index] = "nil"; // TODO void 0
    }
};
Deque.prototype.snap = function (capacity) {
    if (typeof capacity !== "number") {
        return this.minCapacity;
    }
    return pow2AtLeast(Math.min(this.maxCapacity, Math.max(this.minCapacity, capacity)));
};
Deque.prototype.one = function () {
    if (this.length > 0) {
        return this[this.front];
    }
};
Deque.prototype.peek = function () {
    if (this.length === 0) {
        return;
    }
    return this[this.front];
};
Deque.prototype.poke = function (value) {
    if (this.length === 0) {
        return;
    }
    this[this.front] = value;
};
Deque.prototype.peekBack = function () {
    var length = this.length;
    if (length === 0) {
        return;
    }
    var index = (this.front + length - 1) & (this.capacity - 1);
    return this[index];
};
Deque.prototype.pokeBack = function (value) {
    var length = this.length;
    if (length === 0) {
        return;
    }
    var index = (this.front + length - 1) & (this.capacity - 1);
    this[index] = value;
};
Deque.prototype.get = function (index) {
    // Domain only includes integers
    if (index !== (index | 0)) {
        return;
    }
    // Support negative indicies
    if (index < 0) {
        index = index + this.length;
    }
    // Out of bounds
    if (index < 0 || index >= this.length) {
        return;
    }
    return this[(this.front + index) & (this.capacity - 1)];
};
Deque.prototype.indexOf = function (value, index) {
    // Default start index at beginning
    if (index == null) {
        index = 0;
    }
    // Support negative indicies
    if (index < 0) {
        index = index + this.length;
    }
    // Left to right walk
    var mask = this.capacity - 1;
    for (; index < this.length; index++) {
        var offset = (this.front + index) & mask;
        if (this[offset] === value) {
            return index;
        }
    }
    return -1;
};
Deque.prototype.lastIndexOf = function (value, index) {
    // Default start position at the end
    if (index == null) {
        index = this.length - 1;
    }
    // Support negative indicies
    if (index < 0) {
        index = index + this.length;
    }
    // Right to left walk
    var mask = this.capacity - 1;
    for (; index >= 0; index--) {
        var offset = (this.front + index) & mask;
        if (this[offset] === value) {
            return index;
        }
    }
    return -1;
};
var deprecatedWarnNonce = {};
function deprecatedWarn(msg, notOnce) {
    if (typeof console !== 'undefined' &&
        typeof console.warn === 'function' &&
        (notOnce !== true && deprecatedWarnNonce.hasOwnProperty(msg) === false)) {
        console.warn(msg);
        deprecatedWarnNonce[msg]++;
    }
}
// TODO remove in v6 (not present in v2)
Deque.prototype.find = function () {
    deprecatedWarn('Deque#find function is deprecated please use Deque#findValue instead.');
    return this.findValue.apply(this, arguments);
};
Deque.prototype.findValue = function (value, equals, index) {
    equals = equals || Object.equals;
    // Default start index at beginning
    if (index == null) {
        index = 0;
    }
    // Support negative indicies
    if (index < 0) {
        index = index + this.length;
    }
    // Left to right walk
    var mask = this.capacity - 1;
    for (; index < this.length; index++) {
        var offset = (this.front + index) & mask;
        if (equals(value, this[offset])) {
            return index;
        }
    }
    return -1;
};
// TODO remove in v6 (not present in v2)
Deque.prototype.findLast = function () {
    deprecatedWarn('Deque#findLast function is deprecated please use Deque#findLastValue instead.');
    return this.findLastValue.apply(this, arguments);
};
Deque.prototype.findLastValue = function (value, equals, index) {
    equals = equals || Object.equals;
    // Default start position at the end
    if (index == null) {
        index = this.length - 1;
    }
    // Support negative indicies
    if (index < 0) {
        index = index + this.length;
    }
    // Right to left walk
    var mask = this.capacity - 1;
    for (; index >= 0; index--) {
        var offset = (this.front + index) & mask;
        if (equals(value, this[offset])) {
            return index;
        }
    }
    return -1;
};
Deque.prototype.has = function (value, equals) {
    equals = equals || Object.equals;
    // Left to right walk
    var mask = this.capacity - 1;
    for (var index = 0; index < this.length; index++) {
        var offset = (this.front + index) & mask;
        if (this[offset] === value) {
            return true;
        }
    }
    return false;
};
Deque.prototype.reduce = function (callback, basis /*, thisp*/) {
    // TODO account for missing basis argument
    var thisp = arguments[2];
    var mask = this.capacity - 1;
    for (var index = 0; index < this.length; index++) {
        var offset = (this.front + index) & mask;
        basis = callback.call(thisp, basis, this[offset], index, this);
    }
    return basis;
};
Deque.prototype.reduceRight = function (callback, basis /*, thisp*/) {
    // TODO account for missing basis argument
    var thisp = arguments[2];
    var mask = this.capacity - 1;
    for (var index = this.length - 1; index >= 0; index--) {
        var offset = (this.front + index) & mask;
        basis = callback.call(thisp, basis, this[offset], index, this);
    }
    return basis;
};
function copy(source, sourceIndex, target, targetIndex, length) {
    for (var index = 0; index < length; ++index) {
        target[index + targetIndex] = source[index + sourceIndex];
    }
}
function pow2AtLeast(n) {
    n = n >>> 0;
    n = n - 1;
    n = n | (n >> 1);
    n = n | (n >> 2);
    n = n | (n >> 4);
    n = n | (n >> 8);
    n = n | (n >> 16);
    return n + 1;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVxdWUuanMiLCJzb3VyY2VSb290IjoiLi8iLCJzb3VyY2VzIjpbInBhY2thZ2VzL2pzLXByb3RvdHlwZXMvcGFja2FnZXMvY29sbGVjdGlvbnMvZGVxdWUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBRWIsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQ3pCLElBQUksaUJBQWlCLEdBQUcsT0FBTyxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFDeEQsSUFBSSxZQUFZLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFDOUMsSUFBSSxZQUFZLEdBQUcsT0FBTyxDQUFDLHdCQUF3QixDQUFDLENBQUM7QUFFckQsbUJBQW1CO0FBQ25CLGdFQUFnRTtBQUNoRSwwQkFBMEI7QUFDMUIsZ0VBQWdFO0FBQ2hFLHFDQUFxQztBQUNyQyxrRUFBa0U7QUFFbEUsTUFBTSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7QUFDdkIsU0FBUyxLQUFLLENBQUMsTUFBTSxFQUFFLFFBQVE7SUFDM0IsSUFBSSxDQUFDLENBQUMsSUFBSSxZQUFZLEtBQUssQ0FBQyxFQUFFO1FBQzFCLE9BQU8sSUFBSSxLQUFLLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0tBQ3RDO0lBQ0QsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3BDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNaLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ2hCLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ2YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUN6QixDQUFDO0FBRUQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQzdELE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxD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O0FBQ2pCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxucmVxdWlyZShcIi4vc2hpbS1vYmplY3RcIik7XG52YXIgR2VuZXJpY0NvbGxlY3Rpb24gPSByZXF1aXJlKFwiLi9nZW5lcmljLWNvbGxlY3Rpb25cIik7XG52YXIgR2VuZXJpY09yZGVyID0gcmVxdWlyZShcIi4vZ2VuZXJpYy1vcmRlclwiKTtcbnZhciBSYW5nZUNoYW5nZXMgPSByZXF1aXJlKFwiLi9saXN0ZW4vcmFuZ2UtY2hhbmdlc1wiKTtcblxuLy8gYnkgUGV0a2EgQW50b25vdlxuLy8gaHR0cHM6Ly9naXRodWIuY29tL3BldGthYW50b25vdi9kZXF1ZS9ibG9iL21hc3Rlci9qcy9kZXF1ZS5qc1xuLy8gRGVxdWUgc3BlY2lmaWNhbGx5IHVzZXNcbi8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ2lyY3VsYXJfYnVmZmVyI1VzZV9hX0ZpbGxfQ291bnRcbi8vIDEuIEluY3JlbWVudGFsbHkgbWFpbnRhaW5lZCBsZW5ndGhcbi8vIDIuIE1vZHVsdXMgYXZvaWRlZCBieSB1c2luZyBvbmx5IHBvd2VycyBvZiB0d28gZm9yIHRoZSBjYXBhY2l0eVxuXG5tb2R1bGUuZXhwb3J0cyA9IERlcXVlO1xuZnVuY3Rpb24gRGVxdWUodmFsdWVzLCBjYXBhY2l0eSkge1xuICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBEZXF1ZSkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEZXF1ZSh2YWx1ZXMsIGNhcGFjaXR5KTtcbiAgICB9XG4gICAgdGhpcy5jYXBhY2l0eSA9IHRoaXMuc25hcChjYXBhY2l0eSk7XG4gICAgdGhpcy5pbml0KCk7XG4gICAgdGhpcy5sZW5ndGggPSAwO1xuICAgIHRoaXMuZnJvbnQgPSAwO1xuICAgIHRoaXMuYWRkRWFjaCh2YWx1ZXMpO1xufVxuXG5PYmplY3QuYWRkRWFjaChEZXF1ZS5wcm90b3R5cGUsIEdlbmVyaWNDb2xsZWN0aW9uLnByb3RvdHlwZSk7XG5PYmplY3QuYWRkRWFjaChEZXF1ZS5wcm90b3R5cGUsIEdlbmVyaWNPcmRlci5wcm90b3R5cGUpO1xuT2JqZWN0LmFkZEVhY2goRGVxdWUucHJvdG90eXBlLCBSYW5nZUNoYW5nZXMucHJvdG90eXBlKTtcblxuRGVxdWUuZnJvbSA9IEdlbmVyaWNDb2xsZWN0aW9uLmZyb207XG5cbkRlcXVlLnByb3RvdHlwZS5tYXhDYXBhY2l0eSA9ICgxIDw8IDMwKSB8IDA7XG5EZXF1ZS5wcm90b3R5cGUubWluQ2FwYWNpdHkgPSAxNjtcblxuRGVxdWUucHJvdG90eXBlLmNvbnN0cnVjdENsb25lID0gZnVuY3Rpb24gKHZhbHVlcykge1xuICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih2YWx1ZXMsIHRoaXMuY2FwYWNpdHkpXG59O1xuXG5EZXF1ZS5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5wdXNoKHZhbHVlKTtcbn07XG5cbkRlcXVlLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKHZhbHVlIC8qIG9yIC4uLnZhbHVlcyAqLykge1xuICAgIHZhciBhcmdzTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICB2YXIgbGVuZ3RoID0gdGhpcy5sZW5ndGg7XG5cbiAgICBpZiAodGhpcy5kaXNwYXRjaGVzUmFuZ2VDaGFuZ2VzKSB7XG4gICAgICAgIHZhciBwbHVzID0gbmV3IEFycmF5KGFyZ3NMZW5ndGgpO1xuICAgICAgICBmb3IgKHZhciBhcmdJbmRleCA9IDA7IGFyZ0luZGV4IDwgYXJnc0xlbmd0aDsgKythcmdJbmRleCkge1xuICAgICAgICAgICAgcGx1c1thcmdJbmRleF0gPSBhcmd1bWVudHNbYXJnSW5kZXhdO1xuICAgICAgICB9XG4gICAgICAgIHZhciBtaW51cyA9IFtdO1xuICAgICAgICB0aGlzLmRpc3BhdGNoQmVmb3JlUmFuZ2VDaGFuZ2UocGx1cywgbWludXMsIGxlbmd0aCk7XG4gICAgfVxuXG4gICAgaWYgKGFyZ3NMZW5ndGggPiAxKSB7XG4gICAgICAgIHZhciBjYXBhY2l0eSA9IHRoaXMuY2FwYWNpdHk7XG4gICAgICAgIGlmIChsZW5ndGggKyBhcmdzTGVuZ3RoID4gY2FwYWNpdHkpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGFyZ0luZGV4ID0gMDsgYXJnSW5kZXggPCBhcmdzTGVuZ3RoOyArK2FyZ0luZGV4KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbnN1cmVDYXBhY2l0eShsZW5ndGggKyAxKTtcbiAgICAgICAgICAgICAgICB2YXIgaiA9ICh0aGlzLmZyb250ICsgbGVuZ3RoKSAmICh0aGlzLmNhcGFjaXR5IC0gMSk7XG4gICAgICAgICAgICAgICAgdGhpc1tqXSA9IGFyZ3VtZW50c1thcmdJbmRleF07XG4gICAgICAgICAgICAgICAgbGVuZ3RoKys7XG4gICAgICAgICAgICAgICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgaiA9IHRoaXMuZnJvbnQ7XG4gICAgICAgICAgICBmb3IgKHZhciBhcmdJbmRleCA9IDA7IGFyZ0luZGV4IDwgYXJnc0xlbmd0aDsgKythcmdJbmRleCkge1xuICAgICAgICAgICAgICAgIHRoaXNbKGogKyBsZW5ndGgpICYgKGNhcGFjaXR5IC0gMSldID0gYXJndW1lbnRzW2FyZ0luZGV4XTtcbiAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aCArIGFyZ3NMZW5ndGg7XG4gICAgICAgIH1cblxuICAgIH0gZWxzZSBpZiAoYXJnc0xlbmd0aCA9PT0gMSkge1xuICAgICAgICB0aGlzLmVuc3VyZUNhcGFjaXR5KGxlbmd0aCArIDEpO1xuICAgICAgICB2YXIgaW5kZXggPSAodGhpcy5mcm9udCArIGxlbmd0aCkgJiAodGhpcy5jYXBhY2l0eSAtIDEpO1xuICAgICAgICB0aGlzW2luZGV4XSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aCArIDE7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGlzcGF0Y2hlc1JhbmdlQ2hhbmdlcykge1xuICAgICAgICB0aGlzLmRpc3BhdGNoUmFuZ2VDaGFuZ2UocGx1cywgbWludXMsIGxlbmd0aCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMubGVuZ3RoO1xufTtcblxuRGVxdWUucHJvdG90eXBlLnBvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbGVuZ3RoID0gdGhpcy5sZW5ndGg7XG4gICAgaWYgKGxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBpbmRleCA9ICh0aGlzLmZyb250ICsgbGVuZ3RoIC0gMSkgJiAodGhpcy5jYXBhY2l0eSAtIDEpO1xuICAgIHZhciByZXN1bHQgPSB0aGlzW2luZGV4XTtcblxuICAgIGlmICh0aGlzLmRpc3BhdGNoZXNSYW5nZUNoYW5nZXMpIHtcbiAgICAgICAgdGhpcy5kaXNwYXRjaEJlZm9yZVJhbmdlQ2hhbmdlKFtdLCBbcmVzdWx0XSwgbGVuZ3RoIC0gMSk7XG4gICAgfVxuXG4gICAgdGhpc1tpbmRleF0gPSB2b2lkIDA7XG4gICAgdGhpcy5sZW5ndGggPSBsZW5ndGggLSAxO1xuXG4gICAgaWYgKHRoaXMuZGlzcGF0Y2hlc1JhbmdlQ2hhbmdlcykge1xuICAgICAgICB0aGlzLmRpc3BhdGNoUmFuZ2VDaGFuZ2UoW10sIFtyZXN1bHRdLCBsZW5ndGggLSAxKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xufTtcblxuRGVxdWUucHJvdG90eXBlLnNoaWZ0ID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICB2YXIgZnJvbnQgPSB0aGlzLmZyb250O1xuICAgICAgICB2YXIgcmVzdWx0ID0gdGhpc1tmcm9udF07XG5cbiAgICAgICAgaWYgKHRoaXMuZGlzcGF0Y2hlc1JhbmdlQ2hhbmdlcykge1xuICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEJlZm9yZVJhbmdlQ2hhbmdlKFtdLCBbcmVzdWx0XSwgMCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzW2Zyb250XSA9IHZvaWQgMDtcbiAgICAgICAgdGhpcy5mcm9udCA9IChmcm9udCArIDEpICYgKHRoaXMuY2FwYWNpdHkgLSAxKTtcbiAgICAgICAgdGhpcy5sZW5ndGgtLTtcblxuICAgICAgICBpZiAodGhpcy5kaXNwYXRjaGVzUmFuZ2VDaGFuZ2VzKSB7XG4gICAgICAgICAgICB0aGlzLmRpc3BhdGNoUmFuZ2VDaGFuZ2UoW10sIFtyZXN1bHRdLCAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxufTtcblxuRGVxdWUucHJvdG90eXBlLnVuc2hpZnQgPSBmdW5jdGlvbiAodmFsdWUgLyogb3IgLi4udmFsdWVzICovKSB7XG4gICAgdmFyIGxlbmd0aCA9IHRoaXMubGVuZ3RoO1xuICAgIHZhciBhcmdzTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDtcblxuICAgIGlmICh0aGlzLmRpc3BhdGNoZXNSYW5nZUNoYW5nZXMpIHtcbiAgICAgICAgdmFyIHBsdXMgPSBuZXcgQXJyYXkoYXJnc0xlbmd0aCk7XG4gICAgICAgIGZvciAodmFyIGFyZ0luZGV4ID0gMDsgYXJnSW5kZXggPCBhcmdzTGVuZ3RoOyArK2FyZ0luZGV4KSB7XG4gICAgICAgICAgICBwbHVzW2FyZ0luZGV4XSA9IGFyZ3VtZW50c1thcmdJbmRleF07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG1pbnVzID0gW107XG4gICAgICAgIHRoaXMuZGlzcGF0Y2hCZWZvcmVSYW5nZUNoYW5nZShwbHVzLCBtaW51cywgMCk7XG4gICAgfVxuXG4gICAgaWYgKGFyZ3NMZW5ndGggPiAxKSB7XG4gICAgICAgIHZhciBjYXBhY2l0eSA9IHRoaXMuY2FwYWNpdHk7XG4gICAgICAgIGlmIChsZW5ndGggKyBhcmdzTGVuZ3RoID4gY2FwYWNpdHkpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGFyZ0luZGV4ID0gYXJnc0xlbmd0aCAtIDE7IGFyZ0luZGV4ID49IDA7IGFyZ0luZGV4LS0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVuc3VyZUNhcGFjaXR5KGxlbmd0aCArIDEpO1xuICAgICAgICAgICAgICAgIHZhciBjYXBhY2l0eSA9IHRoaXMuY2FwYWNpdHk7XG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gKFxuICAgICAgICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKCB0aGlzLmZyb250IC0gMSApICZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIGNhcGFjaXR5IC0gMSlcbiAgICAgICAgICAgICAgICAgICAgICAgICkgXiBjYXBhY2l0eVxuICAgICAgICAgICAgICAgICAgICApIC0gY2FwYWNpdHlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHRoaXNbaW5kZXhdID0gYXJndW1lbnRzW2FyZ0luZGV4XTtcbiAgICAgICAgICAgICAgICBsZW5ndGgrKztcbiAgICAgICAgICAgICAgICB0aGlzLmZyb250ID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgZnJvbnQgPSB0aGlzLmZyb250O1xuICAgICAgICAgICAgZm9yICh2YXIgYXJnSW5kZXggPSBhcmdzTGVuZ3RoIC0gMTsgYXJnSW5kZXggPj0gMDsgYXJnSW5kZXgtLSkge1xuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IChcbiAgICAgICAgICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmcm9udCAtIDEpICZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2FwYWNpdHkgLSAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgKSBeIGNhcGFjaXR5XG4gICAgICAgICAgICAgICAgICAgICkgLSBjYXBhY2l0eVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgdGhpc1tpbmRleF0gPSBhcmd1bWVudHNbYXJnSW5kZXhdO1xuICAgICAgICAgICAgICAgIGZyb250ID0gaW5kZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmZyb250ID0gZnJvbnQ7XG4gICAgICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aCArIGFyZ3NMZW5ndGg7XG4gICAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGFyZ3NMZW5ndGggPT09IDEpIHtcbiAgICAgICAgdGhpcy5lbnN1cmVDYXBhY2l0eShsZW5ndGggKyAxKTtcbiAgICAgICAgdmFyIGNhcGFjaXR5ID0gdGhpcy5jYXBhY2l0eTtcbiAgICAgICAgdmFyIGluZGV4ID0gKFxuICAgICAgICAgICAgKFxuICAgICAgICAgICAgICAgIChcbiAgICAgICAgICAgICAgICAgICAgKHRoaXMuZnJvbnQgLSAxKSAmXG4gICAgICAgICAgICAgICAgICAgIChjYXBhY2l0eSAtIDEpXG4gICAgICAgICAgICAgICAgKSBeIGNhcGFjaXR5XG4gICAgICAgICAgICApIC0gY2FwYWNpdHlcbiAgICAgICAgKTtcbiAgICAgICAgdGhpc1tpbmRleF0gPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSBsZW5ndGggKyAxO1xuICAgICAgICB0aGlzLmZyb250ID0gaW5kZXg7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGlzcGF0Y2hlc1JhbmdlQ2hhbmdlcykge1xuICAgICAgICB0aGlzLmRpc3BhdGNoUmFuZ2VDaGFuZ2UocGx1cywgbWludXMsIDApO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmxlbmd0aDtcbn07XG5cbkRlcXVlLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxlbmd0aCA9IDA7XG4gICAgdGhpcy5mcm9udCA9IDA7XG4gICAgdGhpcy5pbml0KCk7XG59O1xuXG5EZXF1ZS5wcm90b3R5cGUuZW5zdXJlQ2FwYWNpdHkgPSBmdW5jdGlvbiAoY2FwYWNpdHkpIHtcbiAgICBpZiAodGhpcy5jYXBhY2l0eSA8IGNhcGFjaXR5KSB7XG4gICAgICAgIHRoaXMuZ3Jvdyh0aGlzLnNuYXAodGhpcy5jYXBhY2l0eSAqIDEuNSArIDE2KSk7XG4gICAgfVxufTtcblxuRGVxdWUucHJvdG90eXBlLmdyb3cgPSBmdW5jdGlvbiAoY2FwYWNpdHkpIHtcbiAgICB2YXIgb2xkRnJvbnQgPSB0aGlzLmZyb250O1xuICAgIHZhciBvbGRDYXBhY2l0eSA9IHRoaXMuY2FwYWNpdHk7XG4gICAgdmFyIG9sZENvbnRlbnQgPSBuZXcgQXJyYXkob2xkQ2FwYWNpdHkpO1xuICAgIHZhciBsZW5ndGggPSB0aGlzLmxlbmd0aDtcblxuICAgIGNvcHkodGhpcywgMCwgb2xkQ29udGVudCwgMCwgb2xkQ2FwYWNpdHkpO1xuICAgIHRoaXMuY2FwYWNpdHkgPSBjYXBhY2l0eTtcbiAgICB0aGlzLmluaXQoKTtcbiAgICB0aGlzLmZyb250ID0gMDtcbiAgICBpZiAob2xkRnJvbnQgKyBsZW5ndGggPD0gb2xkQ2FwYWNpdHkpIHtcbiAgICAgICAgLy8gQ2FuIHBlcmZvcm0gZGlyZWN0IGxpbmVhciBjb3B5LlxuICAgICAgICBjb3B5KG9sZENvbnRlbnQsIG9sZEZyb250LCB0aGlzLCAwLCBsZW5ndGgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIENhbm5vdCBwZXJmb3JtIGNvcHkgZGlyZWN0bHksIHBlcmZvcm0gYXMgbXVjaCBhcyBwb3NzaWJsZSBhdCB0aGVcbiAgICAgICAgLy8gZW5kLCBhbmQgdGhlbiBjb3B5IHRoZSByZXN0IHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGJ1ZmZlci5cbiAgICAgICAgdmFyIGxlbmd0aEJlZm9yZVdyYXBwaW5nID0gbGVuZ3RoIC0gKChvbGRGcm9udCArIGxlbmd0aCkgJiAob2xkQ2FwYWNpdHkgLSAxKSk7XG4gICAgICAgIGNvcHkob2xkQ29udGVudCwgb2xkRnJvbnQsIHRoaXMsIDAsIGxlbmd0aEJlZm9yZVdyYXBwaW5nKTtcbiAgICAgICAgY29weShvbGRDb250ZW50LCAwLCB0aGlzLCBsZW5ndGhCZWZvcmVXcmFwcGluZywgbGVuZ3RoIC0gbGVuZ3RoQmVmb3JlV3JhcHBpbmcpO1xuICAgIH1cbn07XG5cbkRlcXVlLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLmNhcGFjaXR5OyArK2luZGV4KSB7XG4gICAgICAgIHRoaXNbaW5kZXhdID0gXCJuaWxcIjsgLy8gVE9ETyB2b2lkIDBcbiAgICB9XG59O1xuXG5EZXF1ZS5wcm90b3R5cGUuc25hcCA9IGZ1bmN0aW9uIChjYXBhY2l0eSkge1xuICAgIGlmICh0eXBlb2YgY2FwYWNpdHkgIT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWluQ2FwYWNpdHk7XG4gICAgfVxuICAgIHJldHVybiBwb3cyQXRMZWFzdChcbiAgICAgICAgTWF0aC5taW4odGhpcy5tYXhDYXBhY2l0eSwgTWF0aC5tYXgodGhpcy5taW5DYXBhY2l0eSwgY2FwYWNpdHkpKVxuICAgICk7XG59O1xuXG5EZXF1ZS5wcm90b3R5cGUub25lID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbdGhpcy5mcm9udF07XG4gICAgfVxufTtcblxuRGVxdWUucHJvdG90eXBlLnBlZWsgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXNbdGhpcy5mcm9udF07XG59O1xuXG5EZXF1ZS5wcm90b3R5cGUucG9rZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXNbdGhpcy5mcm9udF0gPSB2YWx1ZTtcbn07XG5cbkRlcXVlLnByb3RvdHlwZS5wZWVrQmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbGVuZ3RoID0gdGhpcy5sZW5ndGg7XG4gICAgaWYgKGxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBpbmRleCA9ICh0aGlzLmZyb250ICsgbGVuZ3RoIC0gMSkgJiAodGhpcy5jYXBhY2l0eSAtIDEpO1xuICAgIHJldHVybiB0aGlzW2luZGV4XTtcbn07XG5cbkRlcXVlLnByb3RvdHlwZS5wb2tlQmFjayA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHZhciBsZW5ndGggPSB0aGlzLmxlbmd0aDtcbiAgICBpZiAobGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGluZGV4ID0gKHRoaXMuZnJvbnQgKyBsZW5ndGggLSAxKSAmICh0aGlzLmNhcGFjaXR5IC0gMSk7XG4gICAgdGhpc1tpbmRleF0gPSB2YWx1ZTtcbn07XG5cbkRlcXVlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAvLyBEb21haW4gb25seSBpbmNsdWRlcyBpbnRlZ2Vyc1xuICAgIGlmIChpbmRleCAhPT0gKGluZGV4IHwgMCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBTdXBwb3J0IG5lZ2F0aXZlIGluZGljaWVzXG4gICAgaWYgKGluZGV4IDwgMCkge1xuICAgICAgICBpbmRleCA9IGluZGV4ICsgdGhpcy5sZW5ndGg7XG4gICAgfVxuICAgIC8vIE91dCBvZiBib3VuZHNcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IHRoaXMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXNbKHRoaXMuZnJvbnQgKyBpbmRleCkgJiAodGhpcy5jYXBhY2l0eSAtIDEpXTtcbn07XG5cbkRlcXVlLnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24gKHZhbHVlLCBpbmRleCkge1xuICAgIC8vIERlZmF1bHQgc3RhcnQgaW5kZXggYXQgYmVnaW5uaW5nXG4gICAgaWYgKGluZGV4ID09IG51bGwpIHtcbiAgICAgICAgaW5kZXggPSAwO1xuICAgIH1cbiAgICAvLyBTdXBwb3J0IG5lZ2F0aXZlIGluZGljaWVzXG4gICAgaWYgKGluZGV4IDwgMCkge1xuICAgICAgICBpbmRleCA9IGluZGV4ICsgdGhpcy5sZW5ndGg7XG4gICAgfVxuICAgIC8vIExlZnQgdG8gcmlnaHQgd2Fsa1xuICAgIHZhciBtYXNrID0gdGhpcy5jYXBhY2l0eSAtIDE7XG4gICAgZm9yICg7IGluZGV4IDwgdGhpcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgdmFyIG9mZnNldCA9ICh0aGlzLmZyb250ICsgaW5kZXgpICYgbWFzaztcbiAgICAgICAgaWYgKHRoaXNbb2Zmc2V0XSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiBpbmRleDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gLTE7XG59O1xuXG5EZXF1ZS5wcm90b3R5cGUubGFzdEluZGV4T2YgPSBmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7XG4gICAgLy8gRGVmYXVsdCBzdGFydCBwb3NpdGlvbiBhdCB0aGUgZW5kXG4gICAgaWYgKGluZGV4ID09IG51bGwpIHtcbiAgICAgICAgaW5kZXggPSB0aGlzLmxlbmd0aCAtIDE7XG4gICAgfVxuICAgIC8vIFN1cHBvcnQgbmVnYXRpdmUgaW5kaWNpZXNcbiAgICBpZiAoaW5kZXggPCAwKSB7XG4gICAgICAgIGluZGV4ID0gaW5kZXggKyB0aGlzLmxlbmd0aDtcbiAgICB9XG4gICAgLy8gUmlnaHQgdG8gbGVmdCB3YWxrXG4gICAgdmFyIG1hc2sgPSB0aGlzLmNhcGFjaXR5IC0gMTtcbiAgICBmb3IgKDsgaW5kZXggPj0gMDsgaW5kZXgtLSkge1xuICAgICAgICB2YXIgb2Zmc2V0ID0gKHRoaXMuZnJvbnQgKyBpbmRleCkgJiBtYXNrO1xuICAgICAgICBpZiAodGhpc1tvZmZzZXRdID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiAtMTtcbn1cblxudmFyIGRlcHJlY2F0ZWRXYXJuTm9uY2UgPSB7fTtcbmZ1bmN0aW9uIGRlcHJlY2F0ZWRXYXJuKG1zZywgbm90T25jZSkge1xuICAgIGlmIChcbiAgICAgICAgdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgICAgICB0eXBlb2YgY29uc29sZS53YXJuID09PSAnZnVuY3Rpb24nICYmXG4gICAgICAgICAgICAgICAgKG5vdE9uY2UgIT09IHRydWUgJiYgZGVwcmVjYXRlZFdhcm5Ob25jZS5oYXNPd25Qcm9wZXJ0eShtc2cpID09PSBmYWxzZSlcbiAgICApIHtcbiAgICAgICAgY29uc29sZS53YXJuKG1zZyk7XG4gICAgICAgIGRlcHJlY2F0ZWRXYXJuTm9uY2VbbXNnXSsrO1xuICAgIH1cbn1cblxuLy8gVE9ETyByZW1vdmUgaW4gdjYgKG5vdCBwcmVzZW50IGluIHYyKVxuRGVxdWUucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgZGVwcmVjYXRlZFdhcm4oJ0RlcXVlI2ZpbmQgZnVuY3Rpb24gaXMgZGVwcmVjYXRlZCBwbGVhc2UgdXNlIERlcXVlI2ZpbmRWYWx1ZSBpbnN0ZWFkLicpO1xuICAgIHJldHVybiB0aGlzLmZpbmRWYWx1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xufTtcblxuRGVxdWUucHJvdG90eXBlLmZpbmRWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSwgZXF1YWxzLCBpbmRleCkge1xuICAgIGVxdWFscyA9IGVxdWFscyB8fCBPYmplY3QuZXF1YWxzO1xuICAgIC8vIERlZmF1bHQgc3RhcnQgaW5kZXggYXQgYmVnaW5uaW5nXG4gICAgaWYgKGluZGV4ID09IG51bGwpIHtcbiAgICAgICAgaW5kZXggPSAwO1xuICAgIH1cbiAgICAvLyBTdXBwb3J0IG5lZ2F0aXZlIGluZGljaWVzXG4gICAgaWYgKGluZGV4IDwgMCkge1xuICAgICAgICBpbmRleCA9IGluZGV4ICsgdGhpcy5sZW5ndGg7XG4gICAgfVxuICAgIC8vIExlZnQgdG8gcmlnaHQgd2Fsa1xuICAgIHZhciBtYXNrID0gdGhpcy5jYXBhY2l0eSAtIDE7XG4gICAgZm9yICg7IGluZGV4IDwgdGhpcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgdmFyIG9mZnNldCA9ICh0aGlzLmZyb250ICsgaW5kZXgpICYgbWFzaztcbiAgICAgICAgaWYgKGVxdWFscyh2YWx1ZSwgdGhpc1tvZmZzZXRdKSkge1xuICAgICAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiAtMTtcbn07XG5cbi8vIFRPRE8gcmVtb3ZlIGluIHY2IChub3QgcHJlc2VudCBpbiB2MilcbkRlcXVlLnByb3RvdHlwZS5maW5kTGFzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBkZXByZWNhdGVkV2FybignRGVxdWUjZmluZExhc3QgZnVuY3Rpb24gaXMgZGVwcmVjYXRlZCBwbGVhc2UgdXNlIERlcXVlI2ZpbmRMYXN0VmFsdWUgaW5zdGVhZC4nKTtcbiAgICByZXR1cm4gdGhpcy5maW5kTGFzdFZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG59O1xuXG5EZXF1ZS5wcm90b3R5cGUuZmluZExhc3RWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSwgZXF1YWxzLCBpbmRleCkge1xuICAgIGVxdWFscyA9IGVxdWFscyB8fCBPYmplY3QuZXF1YWxzO1xuICAgIC8vIERlZmF1bHQgc3RhcnQgcG9zaXRpb24gYXQgdGhlIGVuZFxuICAgIGlmIChpbmRleCA9PSBudWxsKSB7XG4gICAgICAgIGluZGV4ID0gdGhpcy5sZW5ndGggLSAxO1xuICAgIH1cbiAgICAvLyBTdXBwb3J0IG5lZ2F0aXZlIGluZGljaWVzXG4gICAgaWYgKGluZGV4IDwgMCkge1xuICAgICAgICBpbmRleCA9IGluZGV4ICsgdGhpcy5sZW5ndGg7XG4gICAgfVxuICAgIC8vIFJpZ2h0IHRvIGxlZnQgd2Fsa1xuICAgIHZhciBtYXNrID0gdGhpcy5jYXBhY2l0eSAtIDE7XG4gICAgZm9yICg7IGluZGV4ID49IDA7IGluZGV4LS0pIHtcbiAgICAgICAgdmFyIG9mZnNldCA9ICh0aGlzLmZyb250ICsgaW5kZXgpICYgbWFzaztcbiAgICAgICAgaWYgKGVxdWFscyh2YWx1ZSwgdGhpc1tvZmZzZXRdKSkge1xuICAgICAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiAtMTtcbn07XG5cbkRlcXVlLnByb3RvdHlwZS5oYXMgPSBmdW5jdGlvbiAodmFsdWUsIGVxdWFscykge1xuICAgIGVxdWFscyA9IGVxdWFscyB8fCBPYmplY3QuZXF1YWxzO1xuICAgIC8vIExlZnQgdG8gcmlnaHQgd2Fsa1xuICAgIHZhciBtYXNrID0gdGhpcy5jYXBhY2l0eSAtIDE7XG4gICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgIHZhciBvZmZzZXQgPSAodGhpcy5mcm9udCArIGluZGV4KSAmIG1hc2s7XG4gICAgICAgIGlmICh0aGlzW29mZnNldF0gPT09IHZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59O1xuXG5EZXF1ZS5wcm90b3R5cGUucmVkdWNlID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBiYXNpcyAvKiwgdGhpc3AqLykge1xuICAgIC8vIFRPRE8gYWNjb3VudCBmb3IgbWlzc2luZyBiYXNpcyBhcmd1bWVudFxuICAgIHZhciB0aGlzcCA9IGFyZ3VtZW50c1syXTtcbiAgICB2YXIgbWFzayA9IHRoaXMuY2FwYWNpdHkgLSAxO1xuICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICB2YXIgb2Zmc2V0ID0gKHRoaXMuZnJvbnQgKyBpbmRleCkgJiBtYXNrO1xuICAgICAgICBiYXNpcyA9IGNhbGxiYWNrLmNhbGwodGhpc3AsIGJhc2lzLCB0aGlzW29mZnNldF0sIGluZGV4LCB0aGlzKTtcbiAgICB9XG4gICAgcmV0dXJuIGJhc2lzO1xufTtcblxuRGVxdWUucHJvdG90eXBlLnJlZHVjZVJpZ2h0ID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBiYXNpcyAvKiwgdGhpc3AqLykge1xuICAgIC8vIFRPRE8gYWNjb3VudCBmb3IgbWlzc2luZyBiYXNpcyBhcmd1bWVudFxuICAgIHZhciB0aGlzcCA9IGFyZ3VtZW50c1syXTtcbiAgICB2YXIgbWFzayA9IHRoaXMuY2FwYWNpdHkgLSAxO1xuICAgIGZvciAodmFyIGluZGV4ID0gdGhpcy5sZW5ndGggLSAxOyBpbmRleCA+PSAwOyBpbmRleC0tKSB7XG4gICAgICAgIHZhciBvZmZzZXQgPSAodGhpcy5mcm9udCArIGluZGV4KSAmIG1hc2s7XG4gICAgICAgIGJhc2lzID0gY2FsbGJhY2suY2FsbCh0aGlzcCwgYmFzaXMsIHRoaXNbb2Zmc2V0XSwgaW5kZXgsIHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gYmFzaXM7XG59O1xuXG5mdW5jdGlvbiBjb3B5KHNvdXJjZSwgc291cmNlSW5kZXgsIHRhcmdldCwgdGFyZ2V0SW5kZXgsIGxlbmd0aCkge1xuICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7ICsraW5kZXgpIHtcbiAgICAgICAgdGFyZ2V0W2luZGV4ICsgdGFyZ2V0SW5kZXhdID0gc291cmNlW2luZGV4ICsgc291cmNlSW5kZXhdO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gcG93MkF0TGVhc3Qobikge1xuICAgIG4gPSBuID4+PiAwO1xuICAgIG4gPSBuIC0gMTtcbiAgICBuID0gbiB8IChuID4+IDEpO1xuICAgIG4gPSBuIHwgKG4gPj4gMik7XG4gICAgbiA9IG4gfCAobiA+PiA0KTtcbiAgICBuID0gbiB8IChuID4+IDgpO1xuICAgIG4gPSBuIHwgKG4gPj4gMTYpO1xuICAgIHJldHVybiBuICsgMTtcbn1cbiJdfQ==