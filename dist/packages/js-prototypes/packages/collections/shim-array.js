"use strict";
/*
    Based in part on extras from Motorola Mobility’s Montage
    Copyright (c) 2012, Motorola Mobility LLC. All Rights Reserved.
    3-Clause BSD License
    https://github.com/motorola-mobility/montage/blob/master/LICENSE.md
*/
var Function = require("./shim-function");
var GenericCollection = require("./generic-collection");
var GenericOrder = require("./generic-order");
var WeakMap = require("./weak-map");
module.exports = Array;
var array_splice = Array.prototype.splice;
var array_slice = Array.prototype.slice;
if (!Array.empty) {
    Array.empty = [];
    if (Object.freeze) {
        Object.freeze(Array.empty);
    }
}
if (!Array.nativeFrom) {
    Array.nativeFrom = Array.from;
}
var isSymbolDefined = typeof Symbol !== "undefined";
Array.from = function (values, mapFn, thisArg) {
    if (isSymbolDefined && values && (typeof values[Symbol.iterator] === "function" || typeof mapFn === "function")) {
        return Array.nativeFrom(values, mapFn, thisArg);
    }
    //Now we add support for values that implement forEach:
    var array = [];
    array.addEach(values);
    return array;
};
Array.unzip = function (table) {
    var transpose = [];
    var length = Infinity;
    // compute shortest row
    for (var i = 0; i < table.length; i++) {
        var row = table[i];
        table[i] = row.toArray();
        if (row.length < length) {
            length = row.length;
        }
    }
    for (var i = 0; i < table.length; i++) {
        var row = table[i];
        for (var j = 0; j < row.length; j++) {
            if (j < length && j in row) {
                transpose[j] = transpose[j] || [];
                transpose[j][i] = row[j];
            }
        }
    }
    return transpose;
};
function define(key, value) {
    Object.defineProperty(Array.prototype, key, {
        value: value,
        writable: true,
        configurable: true,
        enumerable: false
    });
}
define("addEach", GenericCollection.prototype.addEach);
define("deleteEach", GenericCollection.prototype.deleteEach);
define("toArray", GenericCollection.prototype.toArray);
define("toObject", GenericCollection.prototype.toObject);
define("all", GenericCollection.prototype.all);
define("any", GenericCollection.prototype.any);
define("min", GenericCollection.prototype.min);
define("max", GenericCollection.prototype.max);
define("sum", GenericCollection.prototype.sum);
define("average", GenericCollection.prototype.average);
define("only", GenericCollection.prototype.only);
define("flatten", GenericCollection.prototype.flatten);
define("zip", GenericCollection.prototype.zip);
define("enumerate", GenericCollection.prototype.enumerate);
define("group", GenericCollection.prototype.group);
define("sorted", GenericCollection.prototype.sorted);
define("reversed", GenericCollection.prototype.reversed);
define("constructClone", function (values) {
    var clone = new this.constructor();
    clone.addEach(values);
    return clone;
});
define("has", function (value, equals) {
    return this.findValue(value, equals) !== -1;
});
define("get", function (index, defaultValue) {
    if (+index !== index) {
        throw new Error("Indicies must be numbers");
    }
    else if (!index in this) {
        return defaultValue;
    }
    else {
        return this[index];
    }
});
define("set", function (index, value) {
    this[index] = value;
    return true;
});
define("add", function (value) {
    this.push(value);
    return true;
});
define("delete", function (value, equals) {
    var index = this.findValue(value, equals);
    if (index !== -1) {
        this.spliceOne(index);
        return true;
    }
    return false;
});
define("deleteAll", function (value, equals) {
    equals = equals || this.contentEquals || Object.equals;
    var count = 0;
    for (var index = 0; index < this.length;) {
        if (equals(value, this[index])) {
            this.swap(index, 1);
            count++;
        }
        else {
            index++;
        }
    }
    return count;
});
// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find
// https://tc39.github.io/ecma262/#sec-array.prototype.find
if (!Array.prototype.find) {
    define("find", function (predicate) {
        // 1. Let O be ? ToObject(this value).
        if (this == null) {
            throw new TypeError('"this" is null or not defined');
        }
        var o = Object(this);
        // 2. Let len be ? ToLength(? Get(O, "length")).
        var len = o.length >>> 0;
        // 3. If IsCallable(predicate) is false, throw a TypeError exception.
        if (typeof predicate !== 'function') {
            throw new TypeError('predicate must be a function');
        }
        // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.
        var thisArg = arguments[1];
        // 5. Let k be 0.
        var k = 0;
        // 6. Repeat, while k < len
        while (k < len) {
            // a. Let Pk be ! ToString(k).
            // b. Let kValue be ? Get(O, Pk).
            // c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).
            // d. If testResult is true, return kValue.
            var kValue = o[k];
            if (predicate.call(thisArg, kValue, k, o)) {
                return kValue;
            }
            // e. Increase k by 1.
            k++;
        }
    });
}
// TODO remove in v6 (not present in v2)
var deprecatedWarnNonce = {};
function deprecatedWarn(msg, notOnce) {
    if (typeof console !== 'undefined' &&
        typeof console.warn === 'function' &&
        (notOnce !== true && deprecatedWarnNonce.hasOwnProperty(msg) === false)) {
        console.warn(msg);
        deprecatedWarnNonce[msg]++;
    }
}
// Save Array.prototype.find in order to support legacy and display warning.
// TODO remove in v6 (not present in v2)
var ArrayFindPrototype = Object.getOwnPropertyDescriptor(Array.prototype, 'find').value;
define("find", function (value, equals, index) {
    if (typeof arguments[0] === 'function' &&
        this instanceof Array) {
        return ArrayFindPrototype.apply(this, arguments);
    }
    else {
        deprecatedWarn('Array#find usage is deprecated please use Array#findValue');
        return this.findValue.apply(this, arguments);
    }
});
define("findValue", function (value, equals, index) {
    if (index) {
        throw new Error("Array#findValue does not support third argument: index");
    }
    equals = equals || this.contentEquals || Object.equals;
    for (var index = 0; index < this.length; index++) {
        if (index in this && equals(value, this[index])) {
            return index;
        }
    }
    return -1;
});
// TODO remove in v6 (not present in v2)
define("findLast", function (value, equals) {
    deprecatedWarn('Array#findLast function is deprecated please use Array#findLastValue instead.');
    return this.findLastValue.apply(this, arguments);
});
define("findLastValue", function (value, equals) {
    equals = equals || this.contentEquals || Object.equals;
    var index = this.length;
    do {
        index--;
        if (index in this && equals(this[index], value)) {
            return index;
        }
    } while (index > 0);
    return -1;
});
define("swap", function (start, length, plus) {
    var args, plusLength, i, j, returnValue;
    if (start > this.length) {
        this.length = start;
    }
    if (typeof plus !== "undefined") {
        args = [start, length];
        if (!Array.isArray(plus)) {
            plus = array_slice.call(plus);
        }
        i = 0;
        plusLength = plus.length;
        // 1000 is a magic number, presumed to be smaller than the remaining
        // stack length. For swaps this small, we take the fast path and just
        // use the underlying Array splice. We could measure the exact size of
        // the remaining stack using a try/catch around an unbounded recursive
        // function, but this would defeat the purpose of short-circuiting in
        // the common case.
        if (plusLength < 1000) {
            for (i; i < plusLength; i++) {
                args[i + 2] = plus[i];
            }
            return array_splice.apply(this, args);
        }
        else {
            // Avoid maximum call stack error.
            // First delete the desired entries.
            returnValue = array_splice.apply(this, args);
            // Second batch in 1000s.
            for (i; i < plusLength;) {
                args = [start + i, 0];
                for (j = 2; j < 1002 && i < plusLength; j++, i++) {
                    args[j] = plus[i];
                }
                array_splice.apply(this, args);
            }
            return returnValue;
        }
        // using call rather than apply to cut down on transient objects
    }
    else if (typeof length !== "undefined") {
        return array_splice.call(this, start, length);
    }
    else if (typeof start !== "undefined") {
        return array_splice.call(this, start);
    }
    else {
        return [];
    }
});
define("peek", function () {
    return this[0];
});
define("poke", function (value) {
    if (this.length > 0) {
        this[0] = value;
    }
});
define("peekBack", function () {
    if (this.length > 0) {
        return this[this.length - 1];
    }
});
define("pokeBack", function (value) {
    if (this.length > 0) {
        this[this.length - 1] = value;
    }
});
define("one", function () {
    for (var i in this) {
        if (Object.owns(this, i)) {
            return this[i];
        }
    }
});
if (!Array.prototype.clear) {
    define("clear", function () {
        this.length = 0;
        return this;
    });
}
define("compare", function (that, compare) {
    compare = compare || Object.compare;
    var i;
    var length;
    var lhs;
    var rhs;
    var relative;
    if (this === that) {
        return 0;
    }
    if (!that || !Array.isArray(that)) {
        return GenericOrder.prototype.compare.call(this, that, compare);
    }
    length = (this.length < that.length) ? this.length : that.length;
    for (i = 0; i < length; i++) {
        if (i in this) {
            if (!(i in that)) {
                return -1;
            }
            else {
                lhs = this[i];
                rhs = that[i];
                relative = compare(lhs, rhs);
                if (relative) {
                    return relative;
                }
            }
        }
        else if (i in that) {
            return 1;
        }
    }
    return this.length - that.length;
});
define("equals", function (that, equals) {
    equals = equals || Object.equals;
    var i = 0;
    var length = this.length;
    var left;
    var right;
    if (this === that) {
        return true;
    }
    if (!that || !Array.isArray(that)) {
        return GenericOrder.prototype.equals.call(this, that);
    }
    if (length !== that.length) {
        return false;
    }
    else {
        for (; i < length; ++i) {
            if (i in this) {
                if (!(i in that)) {
                    return false;
                }
                left = this[i];
                right = that[i];
                if (!equals(left, right)) {
                    return false;
                }
            }
            else {
                if (i in that) {
                    return false;
                }
            }
        }
    }
    return true;
});
define("clone", function (depth, memo) {
    if (depth == null) {
        depth = Infinity;
    }
    else if (depth === 0) {
        return this;
    }
    memo = memo || new WeakMap();
    if (memo.has(this)) {
        return memo.get(this);
    }
    var clone = new Array(this.length);
    memo.set(this, clone);
    for (var i in this) {
        clone[i] = Object.clone(this[i], depth - 1, memo);
    }
    ;
    return clone;
});
define("iterate", function (start, end) {
    return new ArrayIterator(this, start, end);
});
if (Array.prototype.spliceOne === void 0) {
    define("spliceOne", function (index, itemToAdd) {
        var len = this.length;
        if (!len) {
            return;
        }
        if (arguments.length === 1) {
            while (index < len) {
                this[index] = this[index + 1];
                index++;
            }
            this.length--;
        }
        else {
            this[index] = itemToAdd;
        }
    });
}
define("Iterator", ArrayIterator);
function ArrayIterator(array, start, end) {
    this.array = array;
    this.start = start == null ? 0 : start;
    this.end = end;
}
ArrayIterator.prototype.__iterationObject = null;
Object.defineProperty(ArrayIterator.prototype, "_iterationObject", {
    get: function () {
        return this.__iterationObject || (this.__iterationObject = { done: false, value: null });
    }
});
ArrayIterator.prototype.next = function () {
    if (this.start === (this.end == null ? this.array.length : this.end)) {
        this._iterationObject.done = true;
        this._iterationObject.value = void 0;
    }
    else {
        this._iterationObject.value = this.array[this.start++];
    }
    return this._iterationObject;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hpbS1hcnJheS5qcyIsInNvdXJjZVJvb3QiOiIuLyIsInNvdXJjZXMiOlsicGFja2FnZXMvanMtcHJvdG90eXBlcy9wYWNrYWdlcy9jb2xsZWN0aW9ucy9zaGltLWFycmF5LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQztBQUViOzs7OztFQUtFO0FBRUYsSUFBSSxRQUFRLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFDMUMsSUFBSSxpQkFBaUIsR0FBRyxPQUFPLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUN4RCxJQUFJLFlBQVksR0FBRyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUM5QyxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7QUFFcEMsTUFBTSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7QUFFdkIsSUFBSSxZQUFZLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7QUFDMUMsSUFBSSxXQUFXLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7QUFFeEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUU7SUFDZCxLQUFLLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztJQUVqQixJQUFJLE1BQU0sQ0FBQyxNQUFNLEVBQUU7UUFDZixNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUM5QjtDQUNKO0FBRUQsSUFBRyxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUc7SUFDbkIsS0FBSyxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO0NBQ2pDO0FBRUQsSUFBSSxlQUFlLEdBQUcsT0FBTyxNQUFNLEtBQUssV0FBVyxDQUFDO0FBQ3BELEtBQUssQ0FBQyxJQUFJLEdBQUcsVUFBVSxNQUFNLEVBQUUsS0FBSyxFQUFFLE9BQU87SUFDekMsSUFBRyxlQUFlLElBQUksTUFBTSxJQUFJLENBQUMsT0FBTyxN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SSxDQUFDLGdCQUFnQixDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDbEMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQztLQUN4QztTQUFNO1FBQ0gsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO0tBQzFEO0lBQ0QsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7QUFDakMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qXG4gICAgQmFzZWQgaW4gcGFydCBvbiBleHRyYXMgZnJvbSBNb3Rvcm9sYSBNb2JpbGl0eeKAmXMgTW9udGFnZVxuICAgIENvcHlyaWdodCAoYykgMjAxMiwgTW90b3JvbGEgTW9iaWxpdHkgTExDLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICAgIDMtQ2xhdXNlIEJTRCBMaWNlbnNlXG4gICAgaHR0cHM6Ly9naXRodWIuY29tL21vdG9yb2xhLW1vYmlsaXR5L21vbnRhZ2UvYmxvYi9tYXN0ZXIvTElDRU5TRS5tZFxuKi9cblxudmFyIEZ1bmN0aW9uID0gcmVxdWlyZShcIi4vc2hpbS1mdW5jdGlvblwiKTtcbnZhciBHZW5lcmljQ29sbGVjdGlvbiA9IHJlcXVpcmUoXCIuL2dlbmVyaWMtY29sbGVjdGlvblwiKTtcbnZhciBHZW5lcmljT3JkZXIgPSByZXF1aXJlKFwiLi9nZW5lcmljLW9yZGVyXCIpO1xudmFyIFdlYWtNYXAgPSByZXF1aXJlKFwiLi93ZWFrLW1hcFwiKTtcblxubW9kdWxlLmV4cG9ydHMgPSBBcnJheTtcblxudmFyIGFycmF5X3NwbGljZSA9IEFycmF5LnByb3RvdHlwZS5zcGxpY2U7XG52YXIgYXJyYXlfc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG5cbmlmICghQXJyYXkuZW1wdHkpIHtcbiAgICBBcnJheS5lbXB0eSA9IFtdO1xuXG4gICAgaWYgKE9iamVjdC5mcmVlemUpIHtcbiAgICAgICAgT2JqZWN0LmZyZWV6ZShBcnJheS5lbXB0eSk7XG4gICAgfVxufVxuXG5pZighQXJyYXkubmF0aXZlRnJvbSApIHtcbiAgICBBcnJheS5uYXRpdmVGcm9tID0gQXJyYXkuZnJvbTtcbn1cblxudmFyIGlzU3ltYm9sRGVmaW5lZCA9IHR5cGVvZiBTeW1ib2wgIT09IFwidW5kZWZpbmVkXCI7XG5BcnJheS5mcm9tID0gZnVuY3Rpb24gKHZhbHVlcywgbWFwRm4sIHRoaXNBcmcpIHtcbiAgICBpZihpc1N5bWJvbERlZmluZWQgJiYgdmFsdWVzICYmICh0eXBlb2YgdmFsdWVzW1N5bWJvbC5pdGVyYXRvcl0gPT09IFwiZnVuY3Rpb25cIiB8fCB0eXBlb2YgbWFwRm4gPT09IFwiZnVuY3Rpb25cIikpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5Lm5hdGl2ZUZyb20odmFsdWVzLCBtYXBGbiwgdGhpc0FyZyk7XG4gICAgfVxuICAgIC8vTm93IHdlIGFkZCBzdXBwb3J0IGZvciB2YWx1ZXMgdGhhdCBpbXBsZW1lbnQgZm9yRWFjaDpcbiAgICB2YXIgYXJyYXkgPSBbXTtcbiAgICBhcnJheS5hZGRFYWNoKHZhbHVlcyk7XG4gICAgcmV0dXJuIGFycmF5O1xufTtcblxuQXJyYXkudW56aXAgPSBmdW5jdGlvbiAodGFibGUpIHtcbiAgICB2YXIgdHJhbnNwb3NlID0gW107XG4gICAgdmFyIGxlbmd0aCA9IEluZmluaXR5O1xuICAgIC8vIGNvbXB1dGUgc2hvcnRlc3Qgcm93XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YWJsZS5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgcm93ID0gdGFibGVbaV07XG4gICAgICAgIHRhYmxlW2ldID0gcm93LnRvQXJyYXkoKTtcbiAgICAgICAgaWYgKHJvdy5sZW5ndGggPCBsZW5ndGgpIHtcbiAgICAgICAgICAgIGxlbmd0aCA9IHJvdy5sZW5ndGg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YWJsZS5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgcm93ID0gdGFibGVbaV07XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcm93Lmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBpZiAoaiA8IGxlbmd0aCAmJiBqIGluIHJvdykge1xuICAgICAgICAgICAgICAgIHRyYW5zcG9zZVtqXSA9IHRyYW5zcG9zZVtqXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0cmFuc3Bvc2Vbal1baV0gPSByb3dbal07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zcG9zZTtcbn07XG5cbmZ1bmN0aW9uIGRlZmluZShrZXksIHZhbHVlKSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5LnByb3RvdHlwZSwga2V5LCB7XG4gICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2VcbiAgICB9KTtcbn1cblxuZGVmaW5lKFwiYWRkRWFjaFwiLCBHZW5lcmljQ29sbGVjdGlvbi5wcm90b3R5cGUuYWRkRWFjaCk7XG5kZWZpbmUoXCJkZWxldGVFYWNoXCIsIEdlbmVyaWNDb2xsZWN0aW9uLnByb3RvdHlwZS5kZWxldGVFYWNoKTtcbmRlZmluZShcInRvQXJyYXlcIiwgR2VuZXJpY0NvbGxlY3Rpb24ucHJvdG90eXBlLnRvQXJyYXkpO1xuZGVmaW5lKFwidG9PYmplY3RcIiwgR2VuZXJpY0NvbGxlY3Rpb24ucHJvdG90eXBlLnRvT2JqZWN0KTtcbmRlZmluZShcImFsbFwiLCBHZW5lcmljQ29sbGVjdGlvbi5wcm90b3R5cGUuYWxsKTtcbmRlZmluZShcImFueVwiLCBHZW5lcmljQ29sbGVjdGlvbi5wcm90b3R5cGUuYW55KTtcbmRlZmluZShcIm1pblwiLCBHZW5lcmljQ29sbGVjdGlvbi5wcm90b3R5cGUubWluKTtcbmRlZmluZShcIm1heFwiLCBHZW5lcmljQ29sbGVjdGlvbi5wcm90b3R5cGUubWF4KTtcbmRlZmluZShcInN1bVwiLCBHZW5lcmljQ29sbGVjdGlvbi5wcm90b3R5cGUuc3VtKTtcbmRlZmluZShcImF2ZXJhZ2VcIiwgR2VuZXJpY0NvbGxlY3Rpb24ucHJvdG90eXBlLmF2ZXJhZ2UpO1xuZGVmaW5lKFwib25seVwiLCBHZW5lcmljQ29sbGVjdGlvbi5wcm90b3R5cGUub25seSk7XG5kZWZpbmUoXCJmbGF0dGVuXCIsIEdlbmVyaWNDb2xsZWN0aW9uLnByb3RvdHlwZS5mbGF0dGVuKTtcbmRlZmluZShcInppcFwiLCBHZW5lcmljQ29sbGVjdGlvbi5wcm90b3R5cGUuemlwKTtcbmRlZmluZShcImVudW1lcmF0ZVwiLCBHZW5lcmljQ29sbGVjdGlvbi5wcm90b3R5cGUuZW51bWVyYXRlKTtcbmRlZmluZShcImdyb3VwXCIsIEdlbmVyaWNDb2xsZWN0aW9uLnByb3RvdHlwZS5ncm91cCk7XG5kZWZpbmUoXCJzb3J0ZWRcIiwgR2VuZXJpY0NvbGxlY3Rpb24ucHJvdG90eXBlLnNvcnRlZCk7XG5kZWZpbmUoXCJyZXZlcnNlZFwiLCBHZW5lcmljQ29sbGVjdGlvbi5wcm90b3R5cGUucmV2ZXJzZWQpO1xuXG5kZWZpbmUoXCJjb25zdHJ1Y3RDbG9uZVwiLCBmdW5jdGlvbiAodmFsdWVzKSB7XG4gICAgdmFyIGNsb25lID0gbmV3IHRoaXMuY29uc3RydWN0b3IoKTtcbiAgICBjbG9uZS5hZGRFYWNoKHZhbHVlcyk7XG4gICAgcmV0dXJuIGNsb25lO1xufSk7XG5cbmRlZmluZShcImhhc1wiLCBmdW5jdGlvbiAodmFsdWUsIGVxdWFscykge1xuICAgIHJldHVybiB0aGlzLmZpbmRWYWx1ZSh2YWx1ZSwgZXF1YWxzKSAhPT0gLTE7XG59KTtcblxuZGVmaW5lKFwiZ2V0XCIsIGZ1bmN0aW9uIChpbmRleCwgZGVmYXVsdFZhbHVlKSB7XG4gICAgaWYgKCtpbmRleCAhPT0gaW5kZXgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5kaWNpZXMgbXVzdCBiZSBudW1iZXJzXCIpO1xuICAgIH0gZWxzZSBpZiAoIWluZGV4IGluIHRoaXMpIHtcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpc1tpbmRleF07XG4gICAgfVxufSk7XG5cbmRlZmluZShcInNldFwiLCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7XG4gICAgdGhpc1tpbmRleF0gPSB2YWx1ZTtcbiAgICByZXR1cm4gdHJ1ZTtcbn0pO1xuXG5kZWZpbmUoXCJhZGRcIiwgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5wdXNoKHZhbHVlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbn0pO1xuXG5kZWZpbmUoXCJkZWxldGVcIiwgZnVuY3Rpb24gKHZhbHVlLCBlcXVhbHMpIHtcbiAgICB2YXIgaW5kZXggPSB0aGlzLmZpbmRWYWx1ZSh2YWx1ZSwgZXF1YWxzKTtcbiAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgIHRoaXMuc3BsaWNlT25lKGluZGV4KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn0pO1xuXG5kZWZpbmUoXCJkZWxldGVBbGxcIiwgZnVuY3Rpb24gKHZhbHVlLCBlcXVhbHMpIHtcbiAgICBlcXVhbHMgPSBlcXVhbHMgfHwgdGhpcy5jb250ZW50RXF1YWxzIHx8IE9iamVjdC5lcXVhbHM7XG4gICAgdmFyIGNvdW50ID0gMDtcbiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5sZW5ndGg7KSB7XG4gICAgICAgIGlmIChlcXVhbHModmFsdWUsIHRoaXNbaW5kZXhdKSkge1xuICAgICAgICAgICAgdGhpcy5zd2FwKGluZGV4LCAxKTtcbiAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjb3VudDtcbn0pO1xuXG4vLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9BcnJheS9maW5kXG4vLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1hcnJheS5wcm90b3R5cGUuZmluZFxuaWYgKCFBcnJheS5wcm90b3R5cGUuZmluZCkge1xuICAgIGRlZmluZShcImZpbmRcIiwgZnVuY3Rpb24ocHJlZGljYXRlKSB7XG4gICAgICAgIC8vIDEuIExldCBPIGJlID8gVG9PYmplY3QodGhpcyB2YWx1ZSkuXG4gICAgICAgIGlmICh0aGlzID09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1widGhpc1wiIGlzIG51bGwgb3Igbm90IGRlZmluZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBvID0gT2JqZWN0KHRoaXMpO1xuXG4gICAgICAgIC8vIDIuIExldCBsZW4gYmUgPyBUb0xlbmd0aCg/IEdldChPLCBcImxlbmd0aFwiKSkuXG4gICAgICAgIHZhciBsZW4gPSBvLmxlbmd0aCA+Pj4gMDtcblxuICAgICAgICAvLyAzLiBJZiBJc0NhbGxhYmxlKHByZWRpY2F0ZSkgaXMgZmFsc2UsIHRocm93IGEgVHlwZUVycm9yIGV4Y2VwdGlvbi5cbiAgICAgICAgaWYgKHR5cGVvZiBwcmVkaWNhdGUgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ3ByZWRpY2F0ZSBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIDQuIElmIHRoaXNBcmcgd2FzIHN1cHBsaWVkLCBsZXQgVCBiZSB0aGlzQXJnOyBlbHNlIGxldCBUIGJlIHVuZGVmaW5lZC5cbiAgICAgICAgdmFyIHRoaXNBcmcgPSBhcmd1bWVudHNbMV07XG5cbiAgICAgICAgLy8gNS4gTGV0IGsgYmUgMC5cbiAgICAgICAgdmFyIGsgPSAwO1xuXG4gICAgICAgIC8vIDYuIFJlcGVhdCwgd2hpbGUgayA8IGxlblxuICAgICAgICB3aGlsZSAoayA8IGxlbikge1xuICAgICAgICAgICAgLy8gYS4gTGV0IFBrIGJlICEgVG9TdHJpbmcoaykuXG4gICAgICAgICAgICAvLyBiLiBMZXQga1ZhbHVlIGJlID8gR2V0KE8sIFBrKS5cbiAgICAgICAgICAgIC8vIGMuIExldCB0ZXN0UmVzdWx0IGJlIFRvQm9vbGVhbig/IENhbGwocHJlZGljYXRlLCBULCDCqyBrVmFsdWUsIGssIE8gwrspKS5cbiAgICAgICAgICAgIC8vIGQuIElmIHRlc3RSZXN1bHQgaXMgdHJ1ZSwgcmV0dXJuIGtWYWx1ZS5cbiAgICAgICAgICAgIHZhciBrVmFsdWUgPSBvW2tdO1xuICAgICAgICAgICAgaWYgKHByZWRpY2F0ZS5jYWxsKHRoaXNBcmcsIGtWYWx1ZSwgaywgbykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ga1ZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZS4gSW5jcmVhc2UgayBieSAxLlxuICAgICAgICAgICAgaysrO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbi8vIFRPRE8gcmVtb3ZlIGluIHY2IChub3QgcHJlc2VudCBpbiB2MilcbnZhciBkZXByZWNhdGVkV2Fybk5vbmNlID0ge307XG5mdW5jdGlvbiBkZXByZWNhdGVkV2Fybihtc2csIG5vdE9uY2UpIHtcbiAgICBpZiAoXG4gICAgICAgIHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICAgICAgdHlwZW9mIGNvbnNvbGUud2FybiA9PT0gJ2Z1bmN0aW9uJyAmJlxuICAgICAgICAgICAgICAgIChub3RPbmNlICE9PSB0cnVlICYmIGRlcHJlY2F0ZWRXYXJuTm9uY2UuaGFzT3duUHJvcGVydHkobXNnKSA9PT0gZmFsc2UpXG4gICAgKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybihtc2cpO1xuICAgICAgICBkZXByZWNhdGVkV2Fybk5vbmNlW21zZ10rKztcbiAgICB9XG59XG5cbi8vIFNhdmUgQXJyYXkucHJvdG90eXBlLmZpbmQgaW4gb3JkZXIgdG8gc3VwcG9ydCBsZWdhY3kgYW5kIGRpc3BsYXkgd2FybmluZy5cbi8vIFRPRE8gcmVtb3ZlIGluIHY2IChub3QgcHJlc2VudCBpbiB2MilcbnZhciBBcnJheUZpbmRQcm90b3R5cGUgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKEFycmF5LnByb3RvdHlwZSwgJ2ZpbmQnKS52YWx1ZTtcbmRlZmluZShcImZpbmRcIiwgZnVuY3Rpb24gKHZhbHVlLCBlcXVhbHMsIGluZGV4KSB7XG4gICAgaWYgKFxuICAgICAgICB0eXBlb2YgYXJndW1lbnRzWzBdID09PSAnZnVuY3Rpb24nICYmXG4gICAgICAgICAgICB0aGlzIGluc3RhbmNlb2YgQXJyYXlcbiAgICApIHtcbiAgICAgICAgcmV0dXJuIEFycmF5RmluZFByb3RvdHlwZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGRlcHJlY2F0ZWRXYXJuKCdBcnJheSNmaW5kIHVzYWdlIGlzIGRlcHJlY2F0ZWQgcGxlYXNlIHVzZSBBcnJheSNmaW5kVmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmluZFZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxufSk7XG5cbmRlZmluZShcImZpbmRWYWx1ZVwiLCBmdW5jdGlvbiAodmFsdWUsIGVxdWFscywgaW5kZXgpIHtcbiAgICBpZiAoaW5kZXgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXJyYXkjZmluZFZhbHVlIGRvZXMgbm90IHN1cHBvcnQgdGhpcmQgYXJndW1lbnQ6IGluZGV4XCIpO1xuICAgIH1cbiAgICBlcXVhbHMgPSBlcXVhbHMgfHwgdGhpcy5jb250ZW50RXF1YWxzIHx8IE9iamVjdC5lcXVhbHM7XG4gICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgIGlmIChpbmRleCBpbiB0aGlzICYmIGVxdWFscyh2YWx1ZSwgdGhpc1tpbmRleF0pKSB7XG4gICAgICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIC0xO1xufSk7XG5cbi8vIFRPRE8gcmVtb3ZlIGluIHY2IChub3QgcHJlc2VudCBpbiB2MilcbmRlZmluZShcImZpbmRMYXN0XCIsIGZ1bmN0aW9uICh2YWx1ZSwgZXF1YWxzKSB7XG4gICAgZGVwcmVjYXRlZFdhcm4oJ0FycmF5I2ZpbmRMYXN0IGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQgcGxlYXNlIHVzZSBBcnJheSNmaW5kTGFzdFZhbHVlIGluc3RlYWQuJyk7XG4gICAgcmV0dXJuIHRoaXMuZmluZExhc3RWYWx1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xufSk7XG5cbmRlZmluZShcImZpbmRMYXN0VmFsdWVcIiwgZnVuY3Rpb24gKHZhbHVlLCBlcXVhbHMpIHtcbiAgICBlcXVhbHMgPSBlcXVhbHMgfHwgdGhpcy5jb250ZW50RXF1YWxzIHx8IE9iamVjdC5lcXVhbHM7XG4gICAgdmFyIGluZGV4ID0gdGhpcy5sZW5ndGg7XG4gICAgZG8ge1xuICAgICAgICBpbmRleC0tO1xuICAgICAgICBpZiAoaW5kZXggaW4gdGhpcyAmJiBlcXVhbHModGhpc1tpbmRleF0sIHZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgICB9XG4gICAgfSB3aGlsZSAoaW5kZXggPiAwKTtcbiAgICByZXR1cm4gLTE7XG59KTtcblxuZGVmaW5lKFwic3dhcFwiLCBmdW5jdGlvbiAoc3RhcnQsIGxlbmd0aCwgcGx1cykge1xuICAgIHZhciBhcmdzLCBwbHVzTGVuZ3RoLCBpLCBqLCByZXR1cm5WYWx1ZTtcbiAgICBpZiAoc3RhcnQgPiB0aGlzLmxlbmd0aCkge1xuICAgICAgICB0aGlzLmxlbmd0aCA9IHN0YXJ0O1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHBsdXMgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgYXJncyA9IFtzdGFydCwgbGVuZ3RoXTtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHBsdXMpKSB7XG4gICAgICAgICAgICBwbHVzID0gYXJyYXlfc2xpY2UuY2FsbChwbHVzKTtcbiAgICAgICAgfVxuICAgICAgICBpID0gMDtcbiAgICAgICAgcGx1c0xlbmd0aCA9IHBsdXMubGVuZ3RoO1xuICAgICAgICAvLyAxMDAwIGlzIGEgbWFnaWMgbnVtYmVyLCBwcmVzdW1lZCB0byBiZSBzbWFsbGVyIHRoYW4gdGhlIHJlbWFpbmluZ1xuICAgICAgICAvLyBzdGFjayBsZW5ndGguIEZvciBzd2FwcyB0aGlzIHNtYWxsLCB3ZSB0YWtlIHRoZSBmYXN0IHBhdGggYW5kIGp1c3RcbiAgICAgICAgLy8gdXNlIHRoZSB1bmRlcmx5aW5nIEFycmF5IHNwbGljZS4gV2UgY291bGQgbWVhc3VyZSB0aGUgZXhhY3Qgc2l6ZSBvZlxuICAgICAgICAvLyB0aGUgcmVtYWluaW5nIHN0YWNrIHVzaW5nIGEgdHJ5L2NhdGNoIGFyb3VuZCBhbiB1bmJvdW5kZWQgcmVjdXJzaXZlXG4gICAgICAgIC8vIGZ1bmN0aW9uLCBidXQgdGhpcyB3b3VsZCBkZWZlYXQgdGhlIHB1cnBvc2Ugb2Ygc2hvcnQtY2lyY3VpdGluZyBpblxuICAgICAgICAvLyB0aGUgY29tbW9uIGNhc2UuXG4gICAgICAgIGlmIChwbHVzTGVuZ3RoIDwgMTAwMCkge1xuICAgICAgICAgICAgZm9yIChpOyBpIDwgcGx1c0xlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgYXJnc1tpKzJdID0gcGx1c1tpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhcnJheV9zcGxpY2UuYXBwbHkodGhpcywgYXJncyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBBdm9pZCBtYXhpbXVtIGNhbGwgc3RhY2sgZXJyb3IuXG4gICAgICAgICAgICAvLyBGaXJzdCBkZWxldGUgdGhlIGRlc2lyZWQgZW50cmllcy5cbiAgICAgICAgICAgIHJldHVyblZhbHVlID0gYXJyYXlfc3BsaWNlLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICAgICAgLy8gU2Vjb25kIGJhdGNoIGluIDEwMDBzLlxuICAgICAgICAgICAgZm9yIChpOyBpIDwgcGx1c0xlbmd0aDspIHtcbiAgICAgICAgICAgICAgICBhcmdzID0gW3N0YXJ0K2ksIDBdO1xuICAgICAgICAgICAgICAgIGZvciAoaiA9IDI7IGogPCAxMDAyICYmIGkgPCBwbHVzTGVuZ3RoOyBqKyssIGkrKykge1xuICAgICAgICAgICAgICAgICAgICBhcmdzW2pdID0gcGx1c1tpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXJyYXlfc3BsaWNlLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJldHVyblZhbHVlO1xuICAgICAgICB9XG4gICAgLy8gdXNpbmcgY2FsbCByYXRoZXIgdGhhbiBhcHBseSB0byBjdXQgZG93biBvbiB0cmFuc2llbnQgb2JqZWN0c1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGxlbmd0aCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICByZXR1cm4gYXJyYXlfc3BsaWNlLmNhbGwodGhpcywgc3RhcnQsIGxlbmd0aCk7XG4gICAgfSAgZWxzZSBpZiAodHlwZW9mIHN0YXJ0ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHJldHVybiBhcnJheV9zcGxpY2UuY2FsbCh0aGlzLCBzdGFydCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn0pO1xuXG5kZWZpbmUoXCJwZWVrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpc1swXTtcbn0pO1xuXG5kZWZpbmUoXCJwb2tlXCIsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIGlmICh0aGlzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpc1swXSA9IHZhbHVlO1xuICAgIH1cbn0pO1xuXG5kZWZpbmUoXCJwZWVrQmFja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0aGlzLmxlbmd0aCAtIDFdO1xuICAgIH1cbn0pO1xuXG5kZWZpbmUoXCJwb2tlQmFja1wiLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICBpZiAodGhpcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXNbdGhpcy5sZW5ndGggLSAxXSA9IHZhbHVlO1xuICAgIH1cbn0pO1xuXG5kZWZpbmUoXCJvbmVcIiwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIGkgaW4gdGhpcykge1xuICAgICAgICBpZiAoT2JqZWN0Lm93bnModGhpcywgaSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzW2ldO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbmlmICghQXJyYXkucHJvdG90eXBlLmNsZWFyKSB7XG4gICAgZGVmaW5lKFwiY2xlYXJcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxlbmd0aCA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH0pO1xufVxuXG5kZWZpbmUoXCJjb21wYXJlXCIsIGZ1bmN0aW9uICh0aGF0LCBjb21wYXJlKSB7XG4gICAgY29tcGFyZSA9IGNvbXBhcmUgfHwgT2JqZWN0LmNvbXBhcmU7XG4gICAgdmFyIGk7XG4gICAgdmFyIGxlbmd0aDtcbiAgICB2YXIgbGhzO1xuICAgIHZhciByaHM7XG4gICAgdmFyIHJlbGF0aXZlO1xuXG4gICAgaWYgKHRoaXMgPT09IHRoYXQpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgaWYgKCF0aGF0IHx8ICFBcnJheS5pc0FycmF5KHRoYXQpKSB7XG4gICAgICAgIHJldHVybiBHZW5lcmljT3JkZXIucHJvdG90eXBlLmNvbXBhcmUuY2FsbCh0aGlzLCB0aGF0LCBjb21wYXJlKTtcbiAgICB9XG5cbiAgICBsZW5ndGggPSAodGhpcy5sZW5ndGggPCB0aGF0Lmxlbmd0aCkgPyB0aGlzLmxlbmd0aCA6IHRoYXQubGVuZ3RoO1xuXG4gICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChpIGluIHRoaXMpIHtcbiAgICAgICAgICAgIGlmICghKGkgaW4gdGhhdCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxocyA9IHRoaXNbaV07XG4gICAgICAgICAgICAgICAgcmhzID0gdGhhdFtpXTtcbiAgICAgICAgICAgICAgICByZWxhdGl2ZSA9IGNvbXBhcmUobGhzLCByaHMpO1xuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVsYXRpdmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGkgaW4gdGhhdCkge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5sZW5ndGggLSB0aGF0Lmxlbmd0aDtcbn0pO1xuXG5kZWZpbmUoXCJlcXVhbHNcIiwgZnVuY3Rpb24gKHRoYXQsIGVxdWFscykge1xuICAgIGVxdWFscyA9IGVxdWFscyB8fCBPYmplY3QuZXF1YWxzO1xuICAgIHZhciBpID0gMDtcbiAgICB2YXIgbGVuZ3RoID0gdGhpcy5sZW5ndGg7XG4gICAgdmFyIGxlZnQ7XG4gICAgdmFyIHJpZ2h0O1xuXG4gICAgaWYgKHRoaXMgPT09IHRoYXQpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmICghdGhhdCB8fCAhQXJyYXkuaXNBcnJheSh0aGF0KSkge1xuICAgICAgICByZXR1cm4gR2VuZXJpY09yZGVyLnByb3RvdHlwZS5lcXVhbHMuY2FsbCh0aGlzLCB0aGF0KTtcbiAgICB9XG5cbiAgICBpZiAobGVuZ3RoICE9PSB0aGF0Lmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZm9yICg7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKGkgaW4gdGhpcykge1xuICAgICAgICAgICAgICAgIGlmICghKGkgaW4gdGhhdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZWZ0ID0gdGhpc1tpXTtcbiAgICAgICAgICAgICAgICByaWdodCA9IHRoYXRbaV07XG4gICAgICAgICAgICAgICAgaWYgKCFlcXVhbHMobGVmdCwgcmlnaHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChpIGluIHRoYXQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn0pO1xuXG5kZWZpbmUoXCJjbG9uZVwiLCBmdW5jdGlvbiAoZGVwdGgsIG1lbW8pIHtcbiAgICBpZiAoZGVwdGggPT0gbnVsbCkge1xuICAgICAgICBkZXB0aCA9IEluZmluaXR5O1xuICAgIH0gZWxzZSBpZiAoZGVwdGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIG1lbW8gPSBtZW1vIHx8IG5ldyBXZWFrTWFwKCk7XG4gICAgaWYgKG1lbW8uaGFzKHRoaXMpKSB7XG4gICAgICAgIHJldHVybiBtZW1vLmdldCh0aGlzKTtcbiAgICB9XG4gICAgdmFyIGNsb25lID0gbmV3IEFycmF5KHRoaXMubGVuZ3RoKTtcbiAgICBtZW1vLnNldCh0aGlzLCBjbG9uZSk7XG4gICAgZm9yICh2YXIgaSBpbiB0aGlzKSB7XG4gICAgICAgIGNsb25lW2ldID0gT2JqZWN0LmNsb25lKHRoaXNbaV0sIGRlcHRoIC0gMSwgbWVtbyk7XG4gICAgfTtcbiAgICByZXR1cm4gY2xvbmU7XG59KTtcblxuZGVmaW5lKFwiaXRlcmF0ZVwiLCBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgIHJldHVybiBuZXcgQXJyYXlJdGVyYXRvcih0aGlzLCBzdGFydCwgZW5kKTtcbn0pO1xuXG5pZihBcnJheS5wcm90b3R5cGUuc3BsaWNlT25lID09PSB2b2lkIDApIHtcbiAgICBkZWZpbmUoXCJzcGxpY2VPbmVcIiwgZnVuY3Rpb24gKGluZGV4LGl0ZW1Ub0FkZCkge1xuICAgICAgICB2YXIgbGVuPXRoaXMubGVuZ3RoO1xuICAgICAgICBpZiAoIWxlbikgeyByZXR1cm4gfVxuICAgICAgICBpZihhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICB3aGlsZSAoaW5kZXg8bGVuKSB7XG4gICAgICAgICAgICAgICAgdGhpc1tpbmRleF0gPSB0aGlzW2luZGV4KzFdO1xuICAgICAgICAgICAgICAgIGluZGV4KytcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubGVuZ3RoLS07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzW2luZGV4XSA9IGl0ZW1Ub0FkZDtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5kZWZpbmUoXCJJdGVyYXRvclwiLCBBcnJheUl0ZXJhdG9yKTtcblxuZnVuY3Rpb24gQXJyYXlJdGVyYXRvcihhcnJheSwgc3RhcnQsIGVuZCkge1xuICAgIHRoaXMuYXJyYXkgPSBhcnJheTtcbiAgICB0aGlzLnN0YXJ0ID0gc3RhcnQgPT0gbnVsbCA/IDAgOiBzdGFydDtcbiAgICB0aGlzLmVuZCA9IGVuZDtcbn1cblxuQXJyYXlJdGVyYXRvci5wcm90b3R5cGUuX19pdGVyYXRpb25PYmplY3QgPSBudWxsO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5SXRlcmF0b3IucHJvdG90eXBlLFwiX2l0ZXJhdGlvbk9iamVjdFwiLCB7XG4gICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX19pdGVyYXRpb25PYmplY3QgfHwgKHRoaXMuX19pdGVyYXRpb25PYmplY3QgPSB7IGRvbmU6IGZhbHNlLCB2YWx1ZTpudWxsfSk7XG4gICAgfVxufSk7XG5cbkFycmF5SXRlcmF0b3IucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMuc3RhcnQgPT09ICh0aGlzLmVuZCA9PSBudWxsID8gdGhpcy5hcnJheS5sZW5ndGggOiB0aGlzLmVuZCkpIHtcbiAgICAgICAgdGhpcy5faXRlcmF0aW9uT2JqZWN0LmRvbmUgPSB0cnVlO1xuICAgICAgICB0aGlzLl9pdGVyYXRpb25PYmplY3QudmFsdWUgPSB2b2lkIDA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5faXRlcmF0aW9uT2JqZWN0LnZhbHVlID0gdGhpcy5hcnJheVt0aGlzLnN0YXJ0KytdO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5faXRlcmF0aW9uT2JqZWN0O1xufTtcbiJdfQ==